# R2 å¯ç”¨å…¬å…±è®¿é—®æŒ‡å—

## âŒ é”™è¯¯è¯´æ˜

å¦‚æœä½ çœ‹åˆ°ä»¥ä¸‹é”™è¯¯ï¼š
```
Error 404
Object not found

This object does not exist or is not publicly accessible at this URL.
```

è¯´æ˜ R2 å­˜å‚¨æ¡¶**æœªå¯ç”¨å…¬å…±è®¿é—®**ï¼Œéœ€è¦é…ç½®ã€‚

## âœ… è§£å†³æ­¥éª¤

### æ­¥éª¤ 1: ç™»å½• Cloudflare Dashboard

1. è®¿é—® [Cloudflare Dashboard](https://dash.cloudflare.com/)
2. ä½¿ç”¨ä½ çš„è´¦æˆ·ç™»å½•

### æ­¥éª¤ 2: è¿›å…¥ R2 å­˜å‚¨æ¡¶è®¾ç½®

1. åœ¨å·¦ä¾§å¯¼èˆªæ ï¼Œç‚¹å‡» **R2**
2. æ‰¾åˆ°å¹¶ç‚¹å‡»å­˜å‚¨æ¡¶åç§° **`sora2`**
3. è¿›å…¥å­˜å‚¨æ¡¶é¡µé¢

### æ­¥éª¤ 3: å¯ç”¨å…¬å…±è®¿é—®

1. åœ¨å­˜å‚¨æ¡¶é¡µé¢ï¼Œç‚¹å‡» **Settings**ï¼ˆè®¾ç½®ï¼‰é€‰é¡¹å¡
2. æ‰¾åˆ° **Public Access**ï¼ˆå…¬å…±è®¿é—®ï¼‰éƒ¨åˆ†
3. ç‚¹å‡» **Enable Public Access**ï¼ˆå¯ç”¨å…¬å…±è®¿é—®ï¼‰æŒ‰é’®
4. ç¡®è®¤å¯ç”¨

### æ­¥éª¤ 4: é…ç½®è‡ªå®šä¹‰åŸŸåï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦ä½¿ç”¨è‡ªå®šä¹‰åŸŸåè€Œä¸æ˜¯ `pub-xxx.r2.dev`ï¼š

1. åœ¨ Settings > Public Access ä¸­
2. æ‰¾åˆ° **Custom Domain** éƒ¨åˆ†
3. ç‚¹å‡» **Connect Domain**
4. è¾“å…¥ä½ çš„åŸŸåï¼ˆå¦‚ `cdn.yourdomain.com`ï¼‰
5. æŒ‰ç…§æç¤ºé…ç½® DNS è®°å½•

### æ­¥éª¤ 5: éªŒè¯é…ç½®

è®¿é—®å…¬å…± URL æµ‹è¯•ï¼š

```bash
# æµ‹è¯•å­˜å‚¨æ¡¶æ ¹ç›®å½•ï¼ˆåº”è¯¥å¯ä»¥è®¿é—®ï¼‰
https://pub-2868c824f92441499577980a0b61114c.r2.dev/

# å¦‚æœæœ‰æ–‡ä»¶ï¼Œæµ‹è¯•æ–‡ä»¶è®¿é—®
https://pub-2868c824f92441499577980a0b61114c.r2.dev/videos/test.mp4
```

## ğŸ” å…¶ä»–å¯èƒ½çš„é—®é¢˜

### é—®é¢˜ 1: æ–‡ä»¶ä¸å­˜åœ¨

**ç—‡çŠ¶**ï¼šå¯ç”¨å…¬å…±è®¿é—®åä»ç„¶ 404

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. åœ¨ R2 Dashboard ä¸­æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. ç¡®è®¤æ–‡ä»¶è·¯å¾„ï¼ˆkeyï¼‰æ­£ç¡®
3. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²ä¸Šä¼ æˆåŠŸ

### é—®é¢˜ 2: URL è·¯å¾„ä¸æ­£ç¡®

**é”™è¯¯ç¤ºä¾‹**ï¼š
```
âŒ https://pub-xxx.r2.dev/sora2/videos/test.mp4  (é”™è¯¯ï¼šåŒ…å«äº†å­˜å‚¨æ¡¶åç§°)
âœ… https://pub-xxx.r2.dev/videos/test.mp4       (æ­£ç¡®ï¼šç›´æ¥æ˜¯æ–‡ä»¶è·¯å¾„)
```

**æ­£ç¡®æ ¼å¼**ï¼š
```
https://pub-2868c824f92441499577980a0b61114c.r2.dev/{æ–‡ä»¶è·¯å¾„}
```

ä¾‹å¦‚ï¼š
- âœ… `https://pub-xxx.r2.dev/videos/task-123.mp4`
- âœ… `https://pub-xxx.r2.dev/images/hero.jpg`

### é—®é¢˜ 3: æ–‡ä»¶æƒé™é—®é¢˜

**æ£€æŸ¥**ï¼š
1. æ–‡ä»¶æ˜¯å¦å­˜åœ¨äº R2 å­˜å‚¨æ¡¶ä¸­
2. æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
3. å…¬å…±è®¿é—®æ˜¯å¦å·²å¯ç”¨

### é—®é¢˜ 4: å…¬å…±åŸŸåæœªé…ç½®

**å¦‚æœçœ‹åˆ°**ï¼š
```
Error 404
Object not found
```

**å¯èƒ½åŸå› **ï¼š
- å­˜å‚¨æ¡¶æœªå¯ç”¨å…¬å…±è®¿é—®
- å…¬å…±åŸŸåæœªæ­£ç¡®é…ç½®
- æ–‡ä»¶ä¸å­˜åœ¨

## ğŸ“ ä½¿ç”¨ä»£ç æ£€æŸ¥

### æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼š

```bash
# ä½¿ç”¨ API åˆ—å‡ºæ–‡ä»¶
GET /api/admin/r2/list?prefix=videos/

# æˆ–è€…ç›´æ¥è®¿é—®ï¼ˆéœ€è¦å…¬å…±è®¿é—®å·²å¯ç”¨ï¼‰
curl https://pub-2868c824f92441499577980a0b61114c.r2.dev/videos/test.mp4
```

### ä¸Šä¼ æ–‡ä»¶åè®¿é—®ï¼š

```typescript
import { getPublicUrl } from '@/lib/r2/client'

// è·å–å…¬å…± URL
const videoUrl = getPublicUrl('videos/task-123.mp4')
// ç»“æœ: https://pub-2868c824f92441499577980a0b61114c.r2.dev/videos/task-123.mp4

// åœ¨æµè§ˆå™¨ä¸­è®¿é—®æ­¤ URL åº”è¯¥å¯ä»¥ç›´æ¥ä¸‹è½½/æ’­æ”¾
```

## ğŸ›¡ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹

### å¯ç”¨å…¬å…±è®¿é—®åï¼š

- âœ… **æ‰€æœ‰æ–‡ä»¶éƒ½å¯ä»¥é€šè¿‡ URL ç›´æ¥è®¿é—®**ï¼ˆå¦‚æœæœ‰æ­£ç¡®çš„è·¯å¾„ï¼‰
- âš ï¸ **ä¸è¦å­˜å‚¨æ•æ„Ÿä¿¡æ¯**åœ¨å…¬å…±å¯è®¿é—®çš„å­˜å‚¨æ¡¶ä¸­
- âœ… **ä½¿ç”¨æ–‡ä»¶å‘½åè§„åˆ™**ï¼ˆå¦‚ UUIDï¼‰é˜²æ­¢çŒœæµ‹æ–‡ä»¶å
- âœ… **å®šæœŸæ£€æŸ¥**å­˜å‚¨æ¡¶ä¸­çš„æ–‡ä»¶

### å¦‚æœéœ€è¦ç§æœ‰æ–‡ä»¶ï¼š

1. **ä½¿ç”¨ç§æœ‰å­˜å‚¨æ¡¶**ï¼šä¸å¯ç”¨å…¬å…±è®¿é—®
2. **ä½¿ç”¨é¢„ç­¾å URL**ï¼šé€šè¿‡ API ç”Ÿæˆä¸´æ—¶è®¿é—®é“¾æ¥
3. **è®¾ç½® CORS è§„åˆ™**ï¼šé™åˆ¶è®¿é—®æ¥æº

## ğŸ“‹ å¿«é€Ÿæ£€æŸ¥æ¸…å•

å¯ç”¨å…¬å…±è®¿é—®å‰ï¼Œç¡®è®¤ï¼š

- [ ] å·²ç™»å½• Cloudflare Dashboard
- [ ] æ‰¾åˆ°å­˜å‚¨æ¡¶ `sora2`
- [ ] è¿›å…¥ Settings > Public Access
- [ ] ç‚¹å‡» Enable Public Access
- [ ] æµ‹è¯•è®¿é—®å…¬å…± URL

## ğŸ”— ç›¸å…³é“¾æ¥

- [Cloudflare R2 Public Access æ–‡æ¡£](https://developers.cloudflare.com/r2/buckets/public-buckets/)
- [Cloudflare Dashboard - R2](https://dash.cloudflare.com/?to=/:account/r2)

## ğŸ’¡ æç¤º

å¯ç”¨å…¬å…±è®¿é—®åï¼š
- æ–‡ä»¶ URL æ ¼å¼ï¼š`https://pub-xxx.r2.dev/{æ–‡ä»¶è·¯å¾„}`
- æ–‡ä»¶è·¯å¾„ä»å­˜å‚¨æ¡¶æ ¹ç›®å½•å¼€å§‹ï¼ˆä¸åŒ…å«å­˜å‚¨æ¡¶åç§°ï¼‰
- ç¡®ä¿æ–‡ä»¶å·²æˆåŠŸä¸Šä¼ åˆ° R2
- æ£€æŸ¥æ–‡ä»¶è·¯å¾„ï¼ˆkeyï¼‰æ˜¯å¦æ­£ç¡®

