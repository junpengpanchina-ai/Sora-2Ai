# ğŸ”§ Stripe Payment Links é…ç½®å®Œæ•´æŒ‡å—

## æ­¥éª¤ 2: é…ç½® Stripe Payment Linksï¼ˆè¯¦ç»†ç‰ˆï¼‰

### 2.1 ç™»å½• Stripe Dashboard

1. è®¿é—® https://dashboard.stripe.com
2. ä½¿ç”¨ä½ çš„ Stripe è´¦å·ç™»å½•
3. **é‡è¦**: ç¡®è®¤ä½ åœ¨æ­£ç¡®çš„æ¨¡å¼ï¼š
   - **æµ‹è¯•æ¨¡å¼** (Test mode) - ç”¨äºå¼€å‘æµ‹è¯•ï¼ŒURL æ˜¾ç¤º "Test mode"
   - **ç”Ÿäº§æ¨¡å¼** (Live mode) - ç”¨äºçœŸå®æ”¯ä»˜ï¼ŒURL æ˜¾ç¤º "Live mode"
   - å»ºè®®å…ˆåœ¨ **Test mode** æµ‹è¯•ï¼Œç¡®è®¤æ— è¯¯åå†åˆ‡æ¢åˆ° **Live mode**

### 2.2 æ‰¾åˆ° Payment Links

1. åœ¨å·¦ä¾§å¯¼èˆªèœå•ä¸­ï¼Œæ‰¾åˆ°å¹¶ç‚¹å‡» **"Payment Links"**ï¼ˆæ”¯ä»˜é“¾æ¥ï¼‰
   - å¦‚æœçœ‹ä¸åˆ°ï¼Œå¯èƒ½éœ€è¦ç‚¹å‡» **"Products"** â†’ **"Payment Links"**
2. ä½ åº”è¯¥èƒ½çœ‹åˆ°å·²åˆ›å»ºçš„ Payment Links åˆ—è¡¨

### 2.3 é…ç½®æ¯ä¸ª Payment Link

#### ğŸ”¹ Payment Link 1: Starter ($4.9)

**æ‰¾åˆ°å¯¹åº”çš„é“¾æ¥**:
- é‡‘é¢åº”è¯¥æ˜¯ **$4.90**
- æˆ–é“¾æ¥ ID åŒ…å«ä½ ä¹‹å‰åˆ›å»ºçš„æ ‡è¯†

**ç¼–è¾‘é…ç½®**:
1. ç‚¹å‡»è¯¥ Payment Link è¿›å…¥è¯¦æƒ…é¡µ
2. ç‚¹å‡»å³ä¸Šè§’çš„ **"Edit"** æˆ– **"Settings"** æŒ‰é’®
3. æ»šåŠ¨åˆ° **"After payment"** æˆ– **"Redirects"** éƒ¨åˆ†
4. è®¾ç½®ä»¥ä¸‹å†…å®¹ï¼š

   **Success URL** (æˆåŠŸè·³è½¬):
   ```
   https://sora2aivideos.com/billing/success?session_id={CHECKOUT_SESSION_ID}
   ```
   - æ³¨æ„ï¼š`{CHECKOUT_SESSION_ID}` æ˜¯ Stripe çš„å ä½ç¬¦ï¼Œä¸è¦ä¿®æ”¹
   - å¦‚æœä½ çš„åŸŸåä¸æ˜¯ `sora2aivideos.com`ï¼Œè¯·æ›¿æ¢ä¸ºä½ çš„å®é™…åŸŸå

   **Cancel URL** (å–æ¶ˆè·³è½¬):
   ```
   https://sora2aivideos.com/pricing?canceled=1
   ```
   - åŒæ ·ï¼Œæ›¿æ¢ä¸ºä½ çš„å®é™…åŸŸå

5. ç‚¹å‡» **"Save"** æˆ– **"Update"** ä¿å­˜

#### ğŸ”¹ Payment Link 2: Creator ($39)

1. æ‰¾åˆ°é‡‘é¢ä¸º **$39.00** çš„ Payment Link
2. ç‚¹å‡»è¿›å…¥è¯¦æƒ…é¡µ
3. ç‚¹å‡» **"Edit"** æˆ– **"Settings"**
4. åœ¨ **"After payment"** éƒ¨åˆ†è®¾ç½®ï¼š
   - **Success URL**: `https://sora2aivideos.com/billing/success?session_id={CHECKOUT_SESSION_ID}`
   - **Cancel URL**: `https://sora2aivideos.com/pricing?canceled=1`
5. ä¿å­˜

#### ğŸ”¹ Payment Link 3: Studio ($99)

1. æ‰¾åˆ°é‡‘é¢ä¸º **$99.00** çš„ Payment Link
2. é‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œè®¾ç½®ç›¸åŒçš„ Success URL å’Œ Cancel URL
3. ä¿å­˜

#### ğŸ”¹ Payment Link 4: Pro ($299)

1. æ‰¾åˆ°é‡‘é¢ä¸º **$299.00** çš„ Payment Link
2. é‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œè®¾ç½®ç›¸åŒçš„ Success URL å’Œ Cancel URL
3. ä¿å­˜

### 2.4 éªŒè¯ Payment Links

**ç¡®è®¤é“¾æ¥æ­£ç¡®**:
- âœ… $4.9: https://buy.stripe.com/28EbJ14jUg2L6550Ug0kE05
- âœ… $39: https://buy.stripe.com/dRmcN55nY4k33WXfPa0kE03
- âœ… $99: https://buy.stripe.com/6oU7sL17IdUD51132o0kE06
- âœ… $299: https://buy.stripe.com/4gMcN5eYy5o70KLauQ0kE01

**å¦‚æœé“¾æ¥ä¸åŒ¹é…**:
1. æ£€æŸ¥ Stripe Dashboard ä¸­æ¯ä¸ª Payment Link çš„ **"Share"** æˆ– **"Link"** éƒ¨åˆ†
2. å¦‚æœé“¾æ¥ä¸åŒï¼Œæ›´æ–° `app/pricing/page.tsx` ä¸­çš„é“¾æ¥ï¼š

```typescript
const STRIPE_PAYMENT_LINKS: Record<PlanId, string> = {
  free: "",
  starter: "ä½ çš„å®é™… $4.9 é“¾æ¥",
  creator: "ä½ çš„å®é™… $39 é“¾æ¥",
  studio: "ä½ çš„å®é™… $99 é“¾æ¥",
  pro: "ä½ çš„å®é™… $299 é“¾æ¥",
};
```

### 2.5 æµ‹è¯• Payment Linkï¼ˆå¯é€‰ä½†æ¨èï¼‰

1. åœ¨ Stripe Dashboard ä¸­ï¼Œç‚¹å‡»ä»»æ„ Payment Link çš„ **"Share"** æŒ‰é’®
2. å¤åˆ¶é“¾æ¥
3. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼ˆä½¿ç”¨æ— ç—•æ¨¡å¼ï¼‰
4. ä½¿ç”¨ Stripe æµ‹è¯•å¡å®Œæˆæ”¯ä»˜ï¼š
   - å¡å·: `4242 4242 4242 4242`
   - è¿‡æœŸæ—¥æœŸ: ä»»æ„æœªæ¥æ—¥æœŸï¼ˆå¦‚ `12/25`ï¼‰
   - CVC: ä»»æ„ 3 ä½æ•°å­—ï¼ˆå¦‚ `123`ï¼‰
   - é‚®ç¼–: ä»»æ„ 5 ä½æ•°å­—ï¼ˆå¦‚ `12345`ï¼‰
5. æ”¯ä»˜æˆåŠŸåï¼Œåº”è¯¥è·³è½¬åˆ°ä½ çš„ç½‘ç«™ `/billing/success` é¡µé¢
6. æ£€æŸ¥æ˜¯å¦æ˜¾ç¤º "âœ… Credits added successfully!"

---

## æ­¥éª¤ 3: è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆè¯¦ç»†ç‰ˆï¼‰

### 3.1 ç™»å½• Vercel Dashboard

1. è®¿é—® https://vercel.com/dashboard
2. ä½¿ç”¨ä½ çš„ Vercel è´¦å·ç™»å½•
3. æ‰¾åˆ°å¹¶ç‚¹å‡»ä½ çš„é¡¹ç›®ï¼ˆSora-2Aiï¼‰

### 3.2 è·å– Stripe Secret Key

**åœ¨ Stripe Dashboard**:
1. ç¡®ä¿ä½ åœ¨æ­£ç¡®çš„æ¨¡å¼ï¼ˆTest mode æˆ– Live modeï¼‰
2. ç‚¹å‡»å·¦ä¾§èœå•çš„ **"Developers"** â†’ **"API keys"**
3. æ‰¾åˆ° **"Secret key"** éƒ¨åˆ†
4. ç‚¹å‡» **"Reveal test key"**ï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰æˆ– **"Reveal live key"**ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
5. å¤åˆ¶å®Œæ•´çš„ keyï¼ˆæ ¼å¼ï¼š`sk_test_...` æˆ– `sk_live_...`ï¼‰
6. **é‡è¦**: ä¸è¦åˆ†äº«è¿™ä¸ª keyï¼Œå®ƒç­‰åŒäºä½ çš„ Stripe è´¦å·å¯†ç 

### 3.3 åœ¨ Vercel æ·»åŠ ç¯å¢ƒå˜é‡

1. åœ¨ Vercel é¡¹ç›®é¡µé¢ï¼Œç‚¹å‡»é¡¶éƒ¨èœå•çš„ **"Settings"**
2. åœ¨å·¦ä¾§èœå•ä¸­ï¼Œç‚¹å‡» **"Environment Variables"**
3. ç‚¹å‡» **"Add New"** æŒ‰é’®ï¼ˆé€šå¸¸åœ¨å³ä¸Šè§’æˆ–åˆ—è¡¨ä¸Šæ–¹ï¼‰

4. å¡«å†™ç¯å¢ƒå˜é‡ï¼š
   - **Key** (å˜é‡å): `STRIPE_SECRET_KEY`
   - **Value** (å€¼): ç²˜è´´ä½ åˆšæ‰å¤åˆ¶çš„ Stripe Secret Key
   - **Environment** (ç¯å¢ƒ): 
     - âœ… å‹¾é€‰ **Production**ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
     - âœ… å‹¾é€‰ **Preview**ï¼ˆé¢„è§ˆç¯å¢ƒï¼‰
     - âœ… å‹¾é€‰ **Development**ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
     - æˆ–è€…é€‰æ‹© **"All Environments"**

5. ç‚¹å‡» **"Save"** ä¿å­˜

### 3.4 éªŒè¯ç¯å¢ƒå˜é‡å·²æ·»åŠ 

1. åœ¨ Environment Variables åˆ—è¡¨ä¸­ï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ°ï¼š
   - **Name**: `STRIPE_SECRET_KEY`
   - **Value**: `sk_...`ï¼ˆéƒ¨åˆ†éšè—ï¼‰
   - **Environments**: Production, Preview, Development

2. å¦‚æœçœ‹åˆ° âœ…ï¼Œè¯´æ˜æ·»åŠ æˆåŠŸ

### 3.5 é‡æ–°éƒ¨ç½²é¡¹ç›®

**æ–¹æ³• 1: é€šè¿‡ Vercel Dashboard**
1. åœ¨é¡¹ç›®é¡µé¢ï¼Œç‚¹å‡»é¡¶éƒ¨èœå•çš„ **"Deployments"**
2. æ‰¾åˆ°æœ€æ–°çš„éƒ¨ç½²è®°å½•
3. ç‚¹å‡»å³ä¾§çš„ **"..."** (ä¸‰ä¸ªç‚¹)
4. é€‰æ‹© **"Redeploy"**
5. ç¡®è®¤é‡æ–°éƒ¨ç½²

**æ–¹æ³• 2: é€šè¿‡ Git æ¨é€ï¼ˆæ¨èï¼‰**
1. åœ¨æœ¬åœ°é¡¹ç›®ç›®å½•ï¼Œåˆ›å»ºä¸€ä¸ªç©º commitï¼š
   ```bash
   git commit --allow-empty -m "Trigger redeploy for environment variables"
   git push
   ```
2. Vercel ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°æ¨é€å¹¶é‡æ–°éƒ¨ç½²

**æ–¹æ³• 3: ç­‰å¾…è‡ªåŠ¨éƒ¨ç½²**
- å¦‚æœä½ åˆšåˆšæ·»åŠ äº†ç¯å¢ƒå˜é‡ï¼ŒVercel å¯èƒ½ä¼šè‡ªåŠ¨è§¦å‘é‡æ–°éƒ¨ç½²
- æ£€æŸ¥ Deployments é¡µé¢æ˜¯å¦æœ‰æ–°çš„éƒ¨ç½²åœ¨è¿›è¡Œ

### 3.6 éªŒè¯éƒ¨ç½²æˆåŠŸ

1. ç­‰å¾…éƒ¨ç½²å®Œæˆï¼ˆé€šå¸¸ 1-3 åˆ†é’Ÿï¼‰
2. åœ¨ Deployments é¡µé¢ï¼Œæœ€æ–°çš„éƒ¨ç½²åº”è¯¥æ˜¾ç¤º **"Ready"** çŠ¶æ€
3. ç‚¹å‡»éƒ¨ç½²è®°å½•ï¼ŒæŸ¥çœ‹ **"Functions Logs"** ç¡®è®¤æ²¡æœ‰é”™è¯¯
4. è®¿é—®ä½ çš„ç½‘ç«™ï¼Œæµ‹è¯•åŠŸèƒ½æ˜¯å¦æ­£å¸¸

---

## âœ… å®Œæ•´éªŒè¯æ¸…å•

å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œè¯·éªŒè¯ï¼š

### æ•°æ®åº“è¿ç§»éªŒè¯
- [ ] åœ¨ Supabase SQL Editor æ‰§è¡ŒéªŒè¯æŸ¥è¯¢
- [ ] ç¡®è®¤ 5 ä¸ªè¡¨å·²åˆ›å»ºï¼š`wallets`, `user_entitlements`, `usage_daily`, `purchases`, `risk_devices`
- [ ] ç¡®è®¤ 3 ä¸ªå‡½æ•°å·²åˆ›å»ºï¼š`deduct_credits`, `check_and_increment_daily_usage`, `apply_purchase`

### Stripe Payment Links éªŒè¯
- [ ] 4 ä¸ª Payment Links éƒ½å·²è®¾ç½® Success URL
- [ ] 4 ä¸ª Payment Links éƒ½å·²è®¾ç½® Cancel URL
- [ ] ä½¿ç”¨æµ‹è¯•å¡å®Œæˆä¸€æ¬¡æµ‹è¯•æ”¯ä»˜
- [ ] æ”¯ä»˜æˆåŠŸåæ­£ç¡®è·³è½¬åˆ° `/billing/success` é¡µé¢
- [ ] ç§¯åˆ†æ­£ç¡®å…¥è´¦åˆ°é’±åŒ…

### ç¯å¢ƒå˜é‡éªŒè¯
- [ ] `STRIPE_SECRET_KEY` å·²æ·»åŠ åˆ° Vercel
- [ ] ç¯å¢ƒå˜é‡åœ¨æ‰€æœ‰ç¯å¢ƒï¼ˆProduction, Preview, Developmentï¼‰éƒ½å¯ç”¨
- [ ] é¡¹ç›®å·²é‡æ–°éƒ¨ç½²
- [ ] éƒ¨ç½²çŠ¶æ€ä¸º "Ready"

### åŠŸèƒ½éªŒè¯
- [ ] è®¿é—® `/pricing` é¡µé¢ï¼Œç‚¹å‡»è´­ä¹°æŒ‰é’®è·³è½¬åˆ° Stripe
- [ ] å®Œæˆæ”¯ä»˜åç§¯åˆ†æ­£ç¡®æ˜¾ç¤º
- [ ] ç”Ÿæˆè§†é¢‘æ—¶ç§¯åˆ†æ­£ç¡®æ‰£é™¤
- [ ] Starter ç”¨æˆ·çš„æ—¥é™é¢æ­£ç¡®æ‰§è¡Œ

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: Stripe Payment Link æ‰¾ä¸åˆ° "After payment" é€‰é¡¹
**A**: 
- æŸäº›æ—§ç‰ˆæœ¬çš„ Payment Link å¯èƒ½ç•Œé¢ä¸åŒ
- å°è¯•ç‚¹å‡» **"Settings"** â†’ **"Redirects"** æˆ– **"Checkout settings"**
- å¦‚æœè¿˜æ˜¯æ²¡æœ‰ï¼Œå¯èƒ½éœ€è¦åˆ›å»ºæ–°çš„ Payment Link

### Q2: ç¯å¢ƒå˜é‡æ·»åŠ åä¸ç”Ÿæ•ˆ
**A**:
- ç¡®ä¿å·²é‡æ–°éƒ¨ç½²é¡¹ç›®
- æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦åœ¨æ‰€æœ‰ç¯å¢ƒéƒ½æ·»åŠ äº†
- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å¹¶åˆ·æ–°é¡µé¢
- æ£€æŸ¥ Vercel éƒ¨ç½²æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯

### Q3: æ”¯ä»˜æˆåŠŸåæ²¡æœ‰è·³è½¬
**A**:
- æ£€æŸ¥ Success URL æ˜¯å¦æ­£ç¡®ï¼ˆæ³¨æ„åŸŸåï¼‰
- ç¡®è®¤ `{CHECKOUT_SESSION_ID}` å ä½ç¬¦æ²¡æœ‰ä¿®æ”¹
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
- æŸ¥çœ‹ Vercel Functions Logs æ˜¯å¦æœ‰é”™è¯¯

### Q4: æµ‹è¯•æ”¯ä»˜æ—¶æç¤º "Invalid API Key"
**A**:
- ç¡®è®¤ä½¿ç”¨çš„æ˜¯æµ‹è¯•ç¯å¢ƒçš„ Secret Keyï¼ˆ`sk_test_...`ï¼‰
- ç¡®è®¤ç¯å¢ƒå˜é‡åç§°æ­£ç¡®ï¼š`STRIPE_SECRET_KEY`
- ç¡®è®¤å·²é‡æ–°éƒ¨ç½²é¡¹ç›®

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. **Vercel æ—¥å¿—**: Deployments â†’ é€‰æ‹©éƒ¨ç½² â†’ Functions Logs
2. **Stripe æ—¥å¿—**: Dashboard â†’ Developers â†’ Logs
3. **æµè§ˆå™¨æ§åˆ¶å°**: F12 â†’ Console
4. **Supabase æ—¥å¿—**: Dashboard â†’ Logs â†’ Postgres Logs

---

## ğŸ‰ å®Œæˆï¼

å®Œæˆä»¥ä¸Šæ‰€æœ‰æ­¥éª¤åï¼Œä½ çš„å®šä»·ç³»ç»Ÿå°±å¯ä»¥æ­£å¸¸å·¥ä½œäº†ï¼

**ä¸‹ä¸€æ­¥**:
- åœ¨æµ‹è¯•ç¯å¢ƒå®Œæˆä¸€æ¬¡å®Œæ•´çš„æ”¯ä»˜æµç¨‹æµ‹è¯•
- ç¡®è®¤ç§¯åˆ†æ­£ç¡®å…¥è´¦å’Œæ‰£é™¤
- å‡†å¤‡åˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒ

