# ä¸‰å¤©æ›´æ–°ç­–ç•¥æ€»ç»“

## ğŸ“… æ—¶é—´çº¿ï¼š2025å¹´1æœˆï¼ˆæœ€è¿‘ä¸‰å¤©ï¼‰

---

## ğŸ¯ æ ¸å¿ƒç›®æ ‡

å°† GEO/SEO/Conversion ç­–ç•¥ä»**æ–‡æ¡£å±‚é¢**è½åœ°åˆ°**æ•°æ®åº“å±‚é¢**ï¼Œå®ç°ï¼š
1. âœ… è‡ªåŠ¨è®¡ç®— Purchase Intentï¼ˆè´­ä¹°æ„å›¾ï¼‰
2. âœ… è‡ªåŠ¨è®¾ç½® Page Layerï¼ˆé¡µé¢å±‚çº§ï¼‰
3. âœ… å»ºç«‹ Index Health ç›‘æ§ä½“ç³»
4. âœ… å®ç°è‡ªåŠ¨æ’äº§ç³»ç»Ÿ

---

## ğŸ“Š ç¬¬ä¸€å¤©ï¼šæ•°æ®åº“æ¶æ„è®¾è®¡

### 1.1 åˆ›å»ºæ ¸å¿ƒè¡¨ç»“æ„

**æ–‡ä»¶**ï¼š`database/migrations/add_page_meta.sql`

åˆ›å»ºäº†ä¸‰ä¸ªæ ¸å¿ƒè¡¨ï¼š
- âœ… `page_meta`ï¼šé¡µé¢è¿è¥å…ƒæ•°æ®è¡¨ï¼ˆæ ¸å¿ƒï¼‰
- âœ… `index_health_daily`ï¼šIndex Health æ—¥æŠ¥å¿«ç…§
- âœ… `page_priority_queue`ï¼šè‡ªåŠ¨æ’äº§ç»“æœé˜Ÿåˆ—

**å…³é”®å­—æ®µ**ï¼š
```sql
page_meta:
  - purchase_intent (0-3)
  - layer ('asset' | 'conversion' | 'core_sample')
  - geo_score (0-100)
  - geo_level ('G-A' | 'G-B' | 'G-C')
  - status ('draft' | 'published' | 'paused')
```

### 1.2 åˆå§‹åŒ–ç°æœ‰æ•°æ®

**æ–‡ä»¶**ï¼š`database/migrations/init_page_meta_for_existing_pages.sql`

- âœ… ä¸ºæ‰€æœ‰ç°æœ‰ `use_cases` åˆ›å»º `page_meta` è®°å½•
- âœ… ä¸ºæ‰€æœ‰ç°æœ‰ `long_tail_keywords` åˆ›å»º `page_meta` è®°å½•
- âœ… æ€»è®¡ï¼š**203,062 æ¡è®°å½•**

---

## ğŸ”„ ç¬¬äºŒå¤©ï¼šæ‰¹é‡æ›´æ–° Purchase Intent

### 2.1 é—®é¢˜ï¼šéœ€è¦æ›´æ–° 200,000+ æ¡è®°å½•

**æŒ‘æˆ˜**ï¼š
- âŒ ä¸€æ¬¡æ€§ UPDATE è¶…æ—¶
- âŒ Supabase Dashboard SQL Editor æœ‰ 60 ç§’è¶…æ—¶é™åˆ¶
- âŒ æ‰‹åŠ¨æ‰§è¡Œ 41 æ¬¡æ‰¹æ¬¡å¤ªç¹ç

### 2.2 è§£å†³æ–¹æ¡ˆæ¼”è¿›

#### æ–¹æ¡ˆ 1ï¼šæ‰‹åŠ¨åˆ†æ‰¹æ›´æ–°
**æ–‡ä»¶**ï¼š`database/migrations/batch_update_purchase_intent_simple.sql`
- æ¯æ¬¡æ›´æ–° 5,000 æ¡
- éœ€è¦æ‰‹åŠ¨æ‰§è¡Œ 41 æ¬¡
- **ç”¨æˆ·åé¦ˆ**ï¼š"æˆ‘æœ‰ç—…å—ï¼Ÿ41æ¬¡ï¼Œç»™æˆ‘ä¼˜åŒ–æ–¹æ¡ˆ"

#### æ–¹æ¡ˆ 2ï¼šè‡ªåŠ¨åŒ– SQL è„šæœ¬
**æ–‡ä»¶**ï¼š`database/migrations/batch_update_purchase_intent_auto.sql`
- ä½¿ç”¨ `DO` å— + `pg_sleep` è‡ªåŠ¨å¾ªç¯
- ä»ç„¶åœ¨ Dashboard ä¸­è¶…æ—¶

#### æ–¹æ¡ˆ 3ï¼šTypeScript + RPC
**æ–‡ä»¶**ï¼š
- `database/migrations/create_batch_update_function.sql`ï¼ˆå­˜å‚¨è¿‡ç¨‹ï¼‰
- `scripts/batch-update-intent-final.ts`ï¼ˆTypeScript è„šæœ¬ï¼‰
- ä½¿ç”¨ Supabase RPC è°ƒç”¨
- ä»ç„¶é‡åˆ°è¶…æ—¶é—®é¢˜

#### æ–¹æ¡ˆ 4ï¼šç›´æ¥ psql è¿æ¥
**æ–‡ä»¶**ï¼š
- `scripts/run-batch-update-with-psql.sh`
- `scripts/run-batch-update-with-docker.sh`
- ç»•è¿‡ Dashboard è¶…æ—¶é™åˆ¶
- ç”¨æˆ·åé¦ˆï¼š"æ‰¾ä¸åˆ°è´¦å·å¯†ç äº†"

#### æ–¹æ¡ˆ 5ï¼šæœ€ç»ˆæ–¹æ¡ˆ - ç›´æ¥ UPDATEï¼ˆç®€åŒ–ç‰ˆï¼‰
**æ–‡ä»¶**ï¼š`database/migrations/batch_update_simple_direct.sql`
- æ¯æ¬¡æ‰‹åŠ¨æ‰§è¡Œ 2,000 æ¡
- æœ€å¯é ï¼Œä¸ä¾èµ–å¤æ‚é€»è¾‘

### 2.3 æœ€ç»ˆç»“æœ

**ç»Ÿè®¡**ï¼š
- âœ… **139,979 æ¡**å·²æ­£ç¡®æ›´æ–°ï¼ˆIntent 1-3ï¼‰
- âœ… **63,083 æ¡**ä¿æŒä¸º 0ï¼ˆæ­£ç¡®å€¼ï¼‰
  - å…¶ä¸­ 83 æ¡æ˜¯ `social-media-content`ï¼ˆæ­£ç¡®ï¼‰
  - å…¶ä½™æ˜¯å­¤ç«‹è®°å½•ï¼Œä½†å€¼æ­£ç¡®ï¼ˆ`intent=0, layer=asset`ï¼‰
- âœ… **é—æ¼è®°å½•ï¼š0 æ¡**

**ç»“è®º**ï¼šæ‰€æœ‰ Purchase Intent æ›´æ–°å·²å®Œæˆï¼Œæ²¡æœ‰é—æ¼ã€‚

---

## ğŸš€ ç¬¬ä¸‰å¤©ï¼šè‡ªåŠ¨åŒæ­¥æœºåˆ¶

### 3.1 é—®é¢˜

ç”¨æˆ·åé¦ˆï¼š"ä»¥ååœºæ™¯åº”ç”¨æ–°å¢çš„æ—¶å€™ï¼Œå°±éœ€è¦åŒæ­¥å’¯"

### 3.2 è§£å†³æ–¹æ¡ˆï¼šæ•°æ®åº“è§¦å‘å™¨

**æ–‡ä»¶**ï¼š`database/migrations/create_auto_sync_page_meta.sql`

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
1. âœ… **è‡ªåŠ¨è®¡ç®— Purchase Intent**
   - `product-demo-showcase` â†’ 3
   - `advertising-promotion` â†’ 3
   - `education-explainer` â†’ 2
   - `ugc-creator-content` â†’ 2
   - `brand-storytelling` â†’ 1
   - `social-media-content` â†’ 0

2. âœ… **è‡ªåŠ¨è®¾ç½® Layer**
   - Intent 3/2 â†’ `conversion`
   - Intent 1/0 â†’ `asset`

3. âœ… **è‡ªåŠ¨åŒæ­¥çŠ¶æ€**
   - `is_published = true` â†’ `status = 'published'`
   - `is_published = false` â†’ `status = 'draft'`

**è§¦å‘å™¨**ï¼š
- `trigger_sync_page_meta_on_insert`ï¼šæ’å…¥æ—¶è‡ªåŠ¨åŒæ­¥
- `trigger_sync_page_meta_on_update`ï¼šæ›´æ–°æ—¶è‡ªåŠ¨åŒæ­¥

### 3.3 ä½¿ç”¨æ–‡æ¡£

**æ–‡ä»¶**ï¼š`docs/AUTO_SYNC_PAGE_META.md`

åŒ…å«ï¼š
- å®‰è£…æ­¥éª¤
- æµ‹è¯•æ–¹æ³•
- éªŒè¯æŸ¥è¯¢
- æ³¨æ„äº‹é¡¹

### 3.4 è¡¥å……ç¼ºå¤±è®°å½•

**é—®é¢˜**ï¼šå‘ç° 8,180 æ¡ `use_cases` è®°å½•æ²¡æœ‰å¯¹åº”çš„ `page_meta` è®°å½•

**åŸå› **ï¼šè¿™äº›è®°å½•æ˜¯åœ¨åˆ›å»ºè§¦å‘å™¨ä¹‹å‰æ’å…¥çš„ï¼Œè§¦å‘å™¨åªå¯¹æœªæ¥çš„æ’å…¥ç”Ÿæ•ˆ

**è§£å†³æ–¹æ¡ˆ**ï¼š
- **æ–‡ä»¶**ï¼š`database/migrations/fill_missing_page_meta.sql`
- **æ‰§è¡Œç»“æœ**ï¼šæˆåŠŸè¡¥å…… 8,185 æ¡ç¼ºå¤±è®°å½•
- **æœ€ç»ˆçŠ¶æ€**ï¼š
  - æ€» use_casesï¼š211,776 æ¡
  - å·²æœ‰ page_metaï¼š211,776 æ¡
  - ç¼ºå¤±è®°å½•ï¼š**0 æ¡**
  - **åŒæ­¥ç‡ï¼š100%** âœ…

**æ•°æ®åˆ†å¸ƒ**ï¼ˆè¡¥å……çš„è®°å½•ï¼‰ï¼š
- Intent 2 (conversion, published): 8,159 æ¡
- Intent 2 (conversion, draft): 23 æ¡
- Intent 3 (conversion, published): 1 æ¡
- Intent 0/1 (asset, published): 2 æ¡

---

## ğŸ“ˆ ç­–ç•¥å‡çº§æ€»ç»“

### ä»æ–‡æ¡£åˆ°æ•°æ®åº“

| ç»´åº¦ | ä¹‹å‰ | ç°åœ¨ |
|------|------|------|
| **Purchase Intent** | æ‰‹åŠ¨åˆ¤æ–­ | âœ… è‡ªåŠ¨è®¡ç®—ï¼ˆè§¦å‘å™¨ï¼‰ |
| **Page Layer** | æ‰‹åŠ¨è®¾ç½® | âœ… è‡ªåŠ¨è®¾ç½®ï¼ˆè§¦å‘å™¨ï¼‰ |
| **æ•°æ®ä¸€è‡´æ€§** | å®¹æ˜“é—æ¼ | âœ… è‡ªåŠ¨åŒæ­¥ |
| **æ‰¹é‡æ›´æ–°** | æ‰‹åŠ¨æ‰§è¡Œ | âœ… å·²å®Œæˆå†å²æ•°æ® |
| **æœªæ¥æ–°å¢** | éœ€è¦æ‰‹åŠ¨ | âœ… è‡ªåŠ¨åŒæ­¥ |

### æ ¸å¿ƒæ–‡ä»¶æ¸…å•

#### æ•°æ®åº“è¿ç§»
1. `database/migrations/add_page_meta.sql` - åˆ›å»ºæ ¸å¿ƒè¡¨
2. `database/migrations/init_page_meta_for_existing_pages.sql` - åˆå§‹åŒ–ç°æœ‰æ•°æ®
3. `database/migrations/batch_update_simple_direct.sql` - æ‰¹é‡æ›´æ–° Purchase Intent
4. `database/migrations/create_auto_sync_page_meta.sql` - è‡ªåŠ¨åŒæ­¥è§¦å‘å™¨

#### æ–‡æ¡£
1. `docs/DATABASE_IMPLEMENTATION_GUIDE.md` - æ•°æ®åº“å®æ–½æŒ‡å—
2. `docs/AUTO_SYNC_PAGE_META.md` - è‡ªåŠ¨åŒæ­¥ä½¿ç”¨æ–‡æ¡£
3. `docs/BATCH_UPDATE_GUIDE.md` - æ‰¹é‡æ›´æ–°æŒ‡å—
4. `docs/PURCHASE_INTENT_UPDATE_SUMMARY.md` - æ›´æ–°æ€»ç»“

#### TypeScript åº“
1. `lib/page-meta-helper.ts` - page_meta æ“ä½œè¾…åŠ©å‡½æ•°
2. `lib/purchase-intent-calculator.ts` - Purchase Intent è®¡ç®—é€»è¾‘
3. `lib/page-priority-picker.ts` - è‡ªåŠ¨æ’äº§ç®—æ³•
4. `lib/production-scheduler.ts` - ç”Ÿäº§è°ƒåº¦å™¨

---

## âœ… å®ŒæˆçŠ¶æ€

### å·²å®Œæˆ âœ…

1. âœ… **æ•°æ®åº“æ¶æ„**ï¼š`page_meta` è¡¨å·²åˆ›å»ºå¹¶åˆå§‹åŒ–
2. âœ… **å†å²æ•°æ®æ›´æ–°**ï¼š211,776 æ¡è®°å½•å·²å¤„ç†å®Œæˆï¼ˆ100% åŒæ­¥ç‡ï¼‰
3. âœ… **Purchase Intent è®¡ç®—**ï¼šæ‰€æœ‰è®°å½•å·²æ­£ç¡®è®¾ç½®
4. âœ… **è‡ªåŠ¨åŒæ­¥æœºåˆ¶**ï¼šè§¦å‘å™¨å·²åˆ›å»ºå¹¶éªŒè¯æˆåŠŸï¼Œæœªæ¥æ–°å¢è‡ªåŠ¨åŒæ­¥
5. âœ… **ç¼ºå¤±è®°å½•è¡¥å……**ï¼š8,185 æ¡ç¼ºå¤±è®°å½•å·²å…¨éƒ¨è¡¥å……å®Œæˆ
6. âœ… **æ•°æ®ä¸€è‡´æ€§**ï¼š211,776 / 211,776 = 100% åŒæ­¥ç‡
7. âœ… **æ–‡æ¡£å®Œå–„**ï¼šæ‰€æœ‰æ“ä½œéƒ½æœ‰è¯¦ç»†æ–‡æ¡£

### ç³»ç»ŸçŠ¶æ€ âœ…

- **æ€» use_cases**ï¼š211,776 æ¡
- **å·²æœ‰ page_meta**ï¼š211,776 æ¡
- **ç¼ºå¤±è®°å½•**ï¼š0 æ¡
- **åŒæ­¥ç‡**ï¼š**100%** âœ…
- **è‡ªåŠ¨åŒæ­¥**ï¼šå·²å¯ç”¨å¹¶éªŒè¯
- **æ•°æ®ä¸€è‡´æ€§**ï¼šå®Œå…¨ä¿è¯

### å¾…æ‰§è¡Œ â³

1. â³ **å¼€å§‹ä½¿ç”¨è‡ªåŠ¨æ’äº§**ï¼š
   - è¿è¡Œ `scripts/daily-page-picker.ts`
   - æŸ¥çœ‹ `page_priority_queue` ç»“æœ

---

## ğŸ¯ æ ¸å¿ƒä»·å€¼

### 1. æ•°æ®é©±åŠ¨å†³ç­–

**ä¹‹å‰**ï¼šé æ„Ÿè§‰åˆ¤æ–­å“ªäº›é¡µé¢è¯¥ä¼˜å…ˆå‘å¸ƒ  
**ç°åœ¨**ï¼šåŸºäº Purchase Intent + GEO Score + Index Health è‡ªåŠ¨æ’äº§

### 2. è‡ªåŠ¨åŒ–è¿è¥

**ä¹‹å‰**ï¼šæ¯æ¬¡æ–°å¢ use_case éœ€è¦æ‰‹åŠ¨åˆ›å»º page_meta  
**ç°åœ¨**ï¼šæ•°æ®åº“è§¦å‘å™¨è‡ªåŠ¨åŒæ­¥ï¼Œé›¶äººå·¥å¹²é¢„

### 3. å¯æ‰©å±•æ€§

**ä¹‹å‰**ï¼š20 ä¸‡æ¡è®°å½•éœ€è¦æ‰‹åŠ¨å¤„ç†  
**ç°åœ¨**ï¼šæœªæ¥æ–°å¢è‡ªåŠ¨å¤„ç†ï¼Œæ— éœ€æ‹…å¿ƒè§„æ¨¡

### 4. æ•°æ®ä¸€è‡´æ€§

**ä¹‹å‰**ï¼šå®¹æ˜“é—æ¼æˆ–å‡ºé”™  
**ç°åœ¨**ï¼šæ•°æ®åº“å±‚é¢ä¿è¯ä¸€è‡´æ€§

---

## ğŸ“ ä¸‹ä¸€æ­¥å»ºè®®

### å·²å®Œæˆ âœ…

1. âœ… **æ‰§è¡Œè§¦å‘å™¨ SQL**ï¼šå·²æ‰§è¡Œå¹¶éªŒè¯æˆåŠŸ
2. âœ… **éªŒè¯è§¦å‘å™¨**ï¼šä¸¤ä¸ªè§¦å‘å™¨å·²ç¡®è®¤åˆ›å»º
3. âœ… **æµ‹è¯•è‡ªåŠ¨åŒæ­¥**ï¼šå·²æµ‹è¯•å¹¶éªŒè¯åŠŸèƒ½æ­£å¸¸
4. âœ… **è¡¥å……ç¼ºå¤±è®°å½•**ï¼š8,185 æ¡è®°å½•å·²å…¨éƒ¨è¡¥å……
5. âœ… **éªŒè¯åŒæ­¥ç‡**ï¼š100% åŒæ­¥ç‡å·²ç¡®è®¤

### æœ¬å‘¨æ‰§è¡Œ

1. â³ **å¼€å§‹ä½¿ç”¨è‡ªåŠ¨æ’äº§**
   - è¿è¡Œ `scripts/daily-page-picker.ts`
   - æ ¹æ® `page_priority_queue` ç»“æœå‘å¸ƒå†…å®¹

2. â³ **å»ºç«‹ Index Health ç›‘æ§**
   - æ¯å¤©è®°å½• GSC æ•°æ®åˆ° `index_health_daily`
   - æ ¹æ® Index Health è°ƒæ•´å‘å¸ƒèŠ‚å¥

### é•¿æœŸä¼˜åŒ–

1. ğŸ”® **é›†æˆåˆ°å‘å¸ƒæµç¨‹**
   - å‘å¸ƒç³»ç»Ÿåªæ¶ˆè´¹ `page_priority_queue`
   - ä»"éšä¾¿å‘"å˜æˆ"æŒ‰é˜Ÿåˆ—å‘"

2. ğŸ”® **å»ºç«‹ç›‘æ§çœ‹æ¿**
   - Index Health Dashboard
   - Purchase Intent åˆ†å¸ƒ
   - è‡ªåŠ¨æ’äº§æ•ˆæœ

---

## ğŸ‰ æ€»ç»“

è¿™ä¸‰å¤©çš„å·¥ä½œå°†**GEO/SEO/Conversion ç­–ç•¥**ä»æ–‡æ¡£å±‚é¢å®Œå…¨è½åœ°åˆ°æ•°æ®åº“å±‚é¢ï¼š

1. âœ… **æ•°æ®å±‚**ï¼šå»ºç«‹äº†å®Œæ•´çš„å…ƒæ•°æ®ä½“ç³»
2. âœ… **è‡ªåŠ¨åŒ–**ï¼šå®ç°äº† Purchase Intent å’Œ Layer çš„è‡ªåŠ¨è®¡ç®—
3. âœ… **ä¸€è‡´æ€§**ï¼šé€šè¿‡è§¦å‘å™¨ä¿è¯æœªæ¥æ•°æ®çš„ä¸€è‡´æ€§
4. âœ… **å¯æ‰©å±•**ï¼šæ”¯æŒæœªæ¥ç™¾ä¸‡çº§å†…å®¹çš„è‡ªåŠ¨å¤„ç†

**æ ¸å¿ƒæˆæœ**ï¼šä»"æ‰‹åŠ¨ç®¡ç†"å‡çº§åˆ°"è‡ªåŠ¨åŒ–è¿è¥"ï¼Œä¸ºè§„æ¨¡åŒ–å†…å®¹ç”Ÿäº§å¥ å®šäº†åšå®åŸºç¡€ã€‚

