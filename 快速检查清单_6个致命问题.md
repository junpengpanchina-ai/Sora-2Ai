# å¿«é€Ÿæ£€æŸ¥æ¸…å• - 6ä¸ªè‡´å‘½é—®é¢˜

## âš¡ 5åˆ†é’Ÿå¿«é€Ÿæ£€æŸ¥

### â‘  å®šä»·æ•°æ®æºä¸ä¸€è‡´

```bash
# æ£€æŸ¥ä¸¤ä¸ªæ–‡ä»¶çš„ç§¯åˆ†æ•°å­—
grep -A 5 "starter:" lib/billing/planConfig.ts | grep "bonusCredits"
grep -A 5 "starter:" lib/billing/config.ts | grep "bonusCredits"

# åº”è¯¥éƒ½æ˜¯ 200ï¼Œå¦‚æœä¸åŒåˆ™æœ‰é—®é¢˜
```

**ä¿®å¤**ï¼š`config.ts` æ”¹ä¸ºä» `planConfig.ts` å¯¼å…¥

---

### â‘¡ Webhook è·¯å¾„å’Œ RPC å‡½æ•°

```bash
# æ£€æŸ¥å“ªä¸ª webhook æ–‡ä»¶åœ¨ä½¿ç”¨
ls -la app/api/*/webhook/route.ts

# æ£€æŸ¥ RPC è°ƒç”¨
grep -r "rpc.*apply_purchase" app/
grep -r "rpc.*grant_credits_for_purchase" app/

# åº”è¯¥åªæœ‰ä¸€ä¸ªæ­£ç¡®çš„è°ƒç”¨
```

**ä¿®å¤**ï¼šç»Ÿä¸€ä½¿ç”¨ `grant_credits_for_purchase`

---

### â‘¢ RPC å‡½æ•°æ˜¯å¦å­˜åœ¨

```sql
-- åœ¨ Supabase SQL Editor æ‰§è¡Œ
SELECT routine_name FROM information_schema.routines 
WHERE routine_schema = 'public' 
AND routine_name IN (
  'grant_credits_for_purchase',
  'deduct_credits_from_wallet',
  'can_purchase_starter',
  'increment_usage_daily'
);
```

**ä¿®å¤**ï¼šå¦‚æœä¸å­˜åœ¨ï¼Œéœ€è¦åˆ›å»ºæˆ–æ”¹ç”¨ç°æœ‰å‡½æ•°

---

### â‘£ Starter é˜²è–…å­—æ®µ

```sql
-- æ£€æŸ¥è¡¨ç»“æ„
SELECT column_name FROM information_schema.columns 
WHERE table_schema = 'public' 
AND table_name = 'starter_purchase_guards';
```

**åº”è¯¥çœ‹åˆ°**ï¼š`user_id`, `device_id`, `ip`, `email`, `created_at`

**ä¸åº”è¯¥æœ‰**ï¼š`payment_fingerprint`, `payment_last4`ï¼ˆå½“å‰ç‰ˆæœ¬ï¼‰

---

### â‘¤ Webhook è¯†åˆ«ç­–ç•¥

```typescript
// æ£€æŸ¥ webhook æ–‡ä»¶
grep -A 10 "è®¡åˆ’è¯†åˆ«\|plan.*è¯†åˆ«\|itemIdFromAmount" app/api/*/webhook/route.ts

// ä¸åº”è¯¥çœ‹åˆ°é‡‘é¢å…œåº•é€»è¾‘
```

**ä¿®å¤**ï¼šåªç”¨ `metadata.plan_id` å’Œ `payment_link_id`

---

### â‘¥ Veo Pro è§„åˆ™è¯´æ˜

```bash
# æ£€æŸ¥å‰ç«¯æ˜¯å¦æœ‰è¯´æ˜
grep -r "Veo Pro.*permanent\|permanent.*Veo Pro" app/ components/

# å¦‚æœæ²¡æœ‰ï¼Œéœ€è¦æ·»åŠ 
```

**ä¿®å¤**ï¼šåœ¨ Pricing é¡µé¢æˆ– FAQ æ·»åŠ è¯´æ˜

---

## âœ… ä¿®å¤åéªŒè¯

1. **å®šä»·ä¸€è‡´æ€§**ï¼š
   ```typescript
   import { PLAN_CONFIGS } from './planConfig';
   import { PRICING_CONFIG } from './config';
   console.log(PLAN_CONFIGS.starter.bonusCredits === PRICING_CONFIG.plans.starter.bonusCredits); // åº”è¯¥æ˜¯ true
   ```

2. **Webhook æµ‹è¯•**ï¼š
   - Stripe Dashboard â†’ Webhooks â†’ å‘é€æµ‹è¯•äº‹ä»¶
   - æ£€æŸ¥æ—¥å¿—æ˜¯å¦æˆåŠŸå¤„ç†

3. **RPC å‡½æ•°**ï¼š
   - æ‰€æœ‰è°ƒç”¨çš„å‡½æ•°åœ¨ SQL ä¸­éƒ½å­˜åœ¨

4. **Starter é˜²è–…**ï¼š
   - åŒä¸€ device_id ç¬¬äºŒæ¬¡è´­ä¹°è¿”å› 403

5. **Veo Pro è¯´æ˜**ï¼š
   - å‰ç«¯é¡µé¢æœ‰æ¸…æ™°è¯´æ˜

---

## ğŸ“ ä¿®å¤é¡ºåº

1. â‘  å®šä»·æ•°æ®æºï¼ˆ5åˆ†é’Ÿï¼‰
2. â‘¡ Webhook è·¯å¾„ï¼ˆ10åˆ†é’Ÿï¼‰
3. â‘¢ RPC å‡½æ•°ï¼ˆ10åˆ†é’Ÿï¼‰
4. â‘£ Starter é˜²è–…ï¼ˆ5åˆ†é’Ÿï¼‰
5. â‘¤ Webhook è¯†åˆ«ï¼ˆ5åˆ†é’Ÿï¼‰
6. â‘¥ Veo Pro è¯´æ˜ï¼ˆ5åˆ†é’Ÿï¼‰

**æ€»è®¡**ï¼š40åˆ†é’Ÿ

