"use strict";(()=>{var e={};e.id=2215,e.ids=[2215],e.modules={21841:e=>{e.exports=require("@aws-sdk/client-s3")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},93977:e=>{e.exports=require("node:fs/promises")},82148:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>j,patchFetch:()=>V,requestAsyncStorage:()=>D,routeModule:()=>O,serverHooks:()=>F,staticGenerationAsyncStorage:()=>U});var a={};r.r(a),r.d(a,{POST:()=>C,dynamic:()=>A,revalidate:()=>P});var s=r(49303),o=r(88716),i=r(60670),n=r(60730),l=r(49606),c=r(40699),u=r(66527),d=r(12131);async function p(e,t){try{let{data:r,error:a}=await e.from("recharge_records").select("id").eq("user_id",t).eq("is_starter_pack",!0).eq("status","completed").not("completed_at","is",null).order("completed_at",{ascending:!1}).limit(1).single();if(a||!r)return{hasPack:!1,rechargeRecordId:null};return{hasPack:!0,rechargeRecordId:r.id}}catch(e){return console.error("Error checking starter pack:",e),{hasPack:!1,rechargeRecordId:null}}}async function g(e,t,r,a){if("sora-2"===a)return{allowed:!0,currentCount:0,maxCount:1/0};let s="veo-pro"===a?2:3;try{let{data:o,error:i}=await e.from("starter_pack_daily_limits").select("veo_pro_count, veo_fast_count").eq("user_id",t).eq("recharge_record_id",r).eq("date",new Date().toISOString().split("T")[0]).single();if(i||!o)return{allowed:!0,currentCount:0,maxCount:s};let n="veo-pro"===a?o.veo_pro_count||0:o.veo_fast_count||0;return{allowed:n<s,currentCount:n,maxCount:s}}catch(e){return console.error("Error checking daily limit:",e),{allowed:!0,currentCount:0,maxCount:s}}}async function f(e,t,r,a){if("sora-2"===a)return{success:!0};try{let s=new Date().toISOString().split("T")[0],o={user_id:t,recharge_record_id:r,date:s,updated_at:new Date().toISOString()};if("veo-pro"===a){let{data:a}=await e.from("starter_pack_daily_limits").select("veo_pro_count").eq("user_id",t).eq("recharge_record_id",r).eq("date",s).single();o.veo_pro_count=(a?.veo_pro_count||0)+1,o.veo_fast_count=a?.veo_fast_count||0}else{let{data:a}=await e.from("starter_pack_daily_limits").select("veo_fast_count").eq("user_id",t).eq("recharge_record_id",r).eq("date",s).single();o.veo_pro_count=a?.veo_pro_count||0,o.veo_fast_count=(a?.veo_fast_count||0)+1}let{error:i}=await e.from("starter_pack_daily_limits").upsert(o,{onConflict:"user_id,recharge_record_id,date"});if(i)return console.error("Failed to increment daily limit:",i),{success:!1,error:i.message};return{success:!0}}catch(e){return console.error("Error incrementing daily limit:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function _(e,t,r,a,s,o,i,n){try{let{data:l,error:c}=await e.from("veo_pro_usage_logs").insert({user_id:t,video_task_id:r,model_type:a,prompt:s.substring(0,500),aspect_ratio:o,status:"pending",is_from_starter_pack:n,consumption_record_id:i}).select("id").single();if(c)return console.error("Failed to log Veo usage:",c),{success:!1,error:c.message};return{success:!0,logId:l.id}}catch(e){return console.error("Error logging Veo usage:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function m(e,t,r,a,s){try{let o={status:r,completed_at:new Date().toISOString()};a&&(o.failure_reason=a.substring(0,500)),void 0!==s&&(o.retry_count=s);let{error:i}=await e.from("veo_pro_usage_logs").update(o).eq("id",t);if(i)return console.error("Failed to update Veo usage log:",i),{success:!1,error:i.message};return{success:!0}}catch(e){return console.error("Error updating Veo usage log:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}var h=r(84770),y=r.n(h);async function v(e,t){try{let{data:r,error:a}=await e.from("user_usage_stats").select("starter_access_expires_at").eq("user_id",t).single();if(a||!r||!r.starter_access_expires_at)return!1;return new Date(r.starter_access_expires_at)>new Date}catch(e){return console.error("Error checking starter access:",e),!1}}async function w(e,t){try{if(await v(e,t))return{allowed:!1,reason:"starter_access_veo_blocked",message:"Veo is not available during Starter Access. Please wait until access expires or upgrade to a full pack."};let{data:r}=await e.from("risk_flags").select("starter_abuse, abnormal_usage").eq("user_id",t).single();if(r&&(r.starter_abuse||r.abnormal_usage))return{allowed:!1,reason:"risk_flag",message:"Account flagged for suspicious activity. Please contact support."};return{allowed:!0}}catch(e){return console.error("Error checking Veo access:",e),{allowed:!0}}}async function k(e,t,r){try{let{data:a}=await e.from("user_usage_stats").select("starter_access_expires_at, sora_generations_7d").eq("user_id",t).single();if(!a||!(a.starter_access_expires_at&&new Date(a.starter_access_expires_at)>new Date))return{allowed:!0,reason:"no_starter_access"};if("veo-pro"===r)return{allowed:!1,reason:"starter_access_veo_blocked",message:`Veo is not available during Starter Access. Access expires at ${new Date(a.starter_access_expires_at).toLocaleString()}.`,expiresAt:a.starter_access_expires_at};let s=a.sora_generations_7d||0;if(s>=15)return{allowed:!1,reason:"starter_access_limit_reached",message:`Starter Access limit reached (15 Sora generations per 7 days). Access expires at ${new Date(a.starter_access_expires_at).toLocaleString()}.`,expiresAt:a.starter_access_expires_at};return{allowed:!0,reason:"within_limits",remaining:15-s,expiresAt:a.starter_access_expires_at}}catch(e){return console.error("Error checking starter access limits:",e),{allowed:!0}}}async function b(e,t,r,a,s,o,i,n){try{let l=y().createHash("sha256").update(o).digest("hex").substring(0,16),{error:c}=await e.from("generation_logs").insert({user_id:t,model:r,credits_used:a,success:s,ip_hash:l,user_agent:i,video_task_id:n||null});if(c)return console.error("Failed to log generation:",c),{success:!1,error:c.message};return await I(e,t,r),{success:!0}}catch(e){return console.error("Error logging generation:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function I(e,t,r){try{let{data:a}=await e.from("user_usage_stats").select("sora_generations_total, veo_generations_total, sora_generations_7d, veo_generations_7d, updated_at").eq("user_id",t).single(),s=new Date,o=new Date(s.getTime()-6048e5),i=!a?.updated_at||new Date(a.updated_at)<o,n={updated_at:s.toISOString()};"sora-2"===r&&(n.sora_generations_total=(a?.sora_generations_total||0)+1,n.sora_generations_7d=i?1:(a?.sora_generations_7d||0)+1),"veo-flash"===r&&(n.veo_generations_total=(a?.veo_generations_total||0)+1,n.veo_generations_7d=i?1:(a?.veo_generations_7d||0)+1),"veo-pro"===r&&(n.veo_generations_total=(a?.veo_generations_total||0)+1,n.veo_generations_7d=i?1:(a?.veo_generations_7d||0)+1),await e.from("user_usage_stats").upsert({user_id:t,...n},{onConflict:"user_id"})}catch(e){console.error("Error updating usage stats:",e)}}async function x(e,t,r=3){try{let a=y().createHash("sha256").update(t).digest("hex").substring(0,16),{data:s,error:o}=await e.from("generation_logs").select("user_id",{count:"exact"}).eq("ip_hash",a).gte("created_at",new Date(Date.now()-864e5).toISOString());if(o)return console.error("Error checking multi-account risk:",o),{isRisk:!1,accountCount:0};let i=new Set(s?.map(e=>e.user_id)||[]).size;return{isRisk:i>=r,accountCount:i}}catch(e){return console.error("Error checking multi-account risk:",e),{isRisk:!1,accountCount:0}}}var R=r(87070),S=r(91585),E=r(26033);let A="force-dynamic",P=0;function T(e,t){return R.NextResponse.json(e,{...t,headers:{"Content-Type":"application/json; charset=utf-8",...t?.headers}})}let q=S.Ry({prompt:S.Z_().min(1,"Prompt cannot be empty"),url:S.Z_().url().optional().or(S.i0("")),aspectRatio:S.Km(["9:16","16:9"]).optional().default("9:16"),duration:S.Km(["10","15"]).optional().default("10"),useWebhook:S.O7().optional().default(!1),model:S.Km(["sora-2","veo-flash","veo-pro"]).optional().default("sora-2"),firstFrameUrl:S.Z_().url().optional().or(S.i0("")),lastFrameUrl:S.Z_().url().optional().or(S.i0("")),urls:S.IX(S.Z_().url()).optional().default([])});async function C(e){let t=e.headers.get("origin"),a=e.headers.get("referer");if(fetch("http://127.0.0.1:7242/ingest/ef411af9-a357-4528-93a0-017b8708eb6e",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"app/api/video/generate/route.ts:23",message:"Video generate POST - ENTRY",data:{origin:t,referer:a,hasCsrfHeader:!!e.headers.get("x-csrf-token")||!!e.headers.get("x-requested-with"),method:"POST"},timestamp:Date.now(),sessionId:"debug-session",runId:"post-fix",hypothesisId:"D"})}).catch(()=>{}),!function(e){let t=e.headers.get("origin"),r=e.headers.get("referer"),a=function(){let e="http://sora2aivideos.com",t=[];return e&&(t.push(e),e.endsWith("/")?t.push(e.slice(0,-1)):t.push(`${e}/`)),t}();if(t){let e=t;if(e.endsWith("/")&&(e=e.slice(0,-1)),a.some(t=>{let r=t.endsWith("/")?t.slice(0,-1):t;return e===r}))return!0}if(r)try{let e=new URL(r).origin,t=e.endsWith("/")?e.slice(0,-1):e;return a.some(e=>{let r=e.endsWith("/")?e.slice(0,-1):e;return t===r})}catch{}return!1}(e))return fetch("http://127.0.0.1:7242/ingest/ef411af9-a357-4528-93a0-017b8708eb6e",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"app/api/video/generate/route.ts:30",message:"Video generate POST - CSRF REJECTED",data:{origin:t,referer:a},timestamp:Date.now(),sessionId:"debug-session",runId:"post-fix",hypothesisId:"D"})}).catch(()=>{}),T({error:"Invalid origin"},{status:403});try{let t,a;let s=await (0,n.e)(e.headers),{data:{user:o}}=await s.auth.getUser();if(!o)return T({error:"Unauthorized, please login first"},{status:401});let i=await (0,d.getOrCreateUser)(s,o);if(!i)return console.error("[video/generate] Failed to get or create user:",{userId:o.id,email:o.email,googleId:o.user_metadata?.provider_id||o.user_metadata?.sub||o.id}),T({error:"User not found or failed to create user",details:"Please try logging out and logging back in, or contact support if the issue persists."},{status:404});let h=await e.json();if(h.prompt&&"string"==typeof h.prompt)try{h.prompt=h.prompt.replace(/^create\s+a\s+professional\s+create\s+a\s+professional\s+/i,"Create a professional ").replace(/\s+/g," ").trim(),Buffer.from(h.prompt,"utf8").toString("utf8")!==h.prompt&&console.warn("[video/generate] Potential encoding issue detected in prompt")}catch(e){console.error("[video/generate] Error normalizing prompt:",e)}let y=q.parse(h),v=e.headers.get("origin"),I="http://sora2aivideos.com";fetch("http://127.0.0.1:7242/ingest/ef411af9-a357-4528-93a0-017b8708eb6e",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"app/api/video/generate/route.ts:65",message:"Webhook URL construction - BEFORE",data:{originHeader:v,envBaseUrl:I,useWebhook:y.useWebhook,userId:o.id},timestamp:Date.now(),sessionId:"debug-session",runId:"post-fix",hypothesisId:"A"})}).catch(()=>{});let R="http://sora2aivideos.com";fetch("http://127.0.0.1:7242/ingest/ef411af9-a357-4528-93a0-017b8708eb6e",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"app/api/video/generate/route.ts:73",message:"Webhook URL construction - AFTER (FIXED)",data:{baseUrl:R,webhookUrl:y.useWebhook?`${R}/api/video/callback`:"-1",originHeaderRejected:!!v&&!I},timestamp:Date.now(),sessionId:"debug-session",runId:"post-fix",hypothesisId:"A"})}).catch(()=>{});let S=y.useWebhook?`${R}/api/video/callback`:"-1",E=e.headers.get("x-forwarded-for")?.split(",")[0]||e.headers.get("x-real-ip")||"unknown",A=e.headers.get("user-agent")||"unknown",P=y.model||"sora-2",C=P.startsWith("veo"),O=await k(s,i.id,P);if(!O.allowed)return T({error:O.message||"Access limit reached",limitReached:!0,reason:O.reason,expiresAt:O.expiresAt},{status:429});if(C){let e=await w(s,i.id);if(!e.allowed)return T({error:e.message||"Veo is not available",reason:e.reason},{status:403})}if(C){let{hasPack:e,rechargeRecordId:t}=await p(s,i.id);if(e&&t){let e=await g(s,i.id,t,P);if(!e.allowed)return T({error:`Daily limit reached for ${P}. You have used ${e.currentCount}/${e.maxCount} today. Please try again tomorrow or upgrade to a full pack.`,limitReached:!0,currentCount:e.currentCount,maxCount:e.maxCount},{status:429})}}let D=await x(s,E);D.isRisk&&D.accountCount>=3&&(console.warn("[video/generate] Multi-account risk detected:",{userId:i.id,ip:E,accountCount:D.accountCount}),await s.from("risk_flags").upsert({user_id:i.id,multi_account_suspected:!0,note:`Detected ${D.accountCount} accounts from same IP`,updated_at:new Date().toISOString()},{onConflict:"user_id"}));let{data:U,error:F}=await s.from("video_tasks").insert({user_id:i.id,model:P,prompt:y.prompt,reference_url:y.url||null,aspect_ratio:y.aspectRatio,duration:C?null:parseInt(y.duration),size:C?null:"small",status:"pending",webhook_url:"-1"!==S?S:null}).select().single();if(F||!U)return console.error("Failed to create video task:",F),T({error:"Failed to create video task",details:F?.message},{status:500});let j=await (0,u.dp)(s,i.id,U.id,`Video generation: ${y.prompt.substring(0,50)}...`,P);if(!j.success)return await s.from("video_tasks").delete().eq("id",U.id),T({error:j.error||"Insufficient credits"},{status:400});let V=j.consumptionId;if(C){let{hasPack:e}=await p(s,i.id),r="veo-flash"===P?"veo-flash":"veo-pro";t=(await _(s,i.id,U.id,r,y.prompt,y.aspectRatio,V||null,e)).logId}try{if(C){let e={model:"veo-flash"===P?"veo3.1-fast":"veo3.1-pro",prompt:y.prompt,aspectRatio:y.aspectRatio,webHook:S,shutProgress:!1,...y.firstFrameUrl&&{firstFrameUrl:y.firstFrameUrl},...y.lastFrameUrl&&{lastFrameUrl:y.lastFrameUrl},...y.urls&&y.urls.length>0&&{urls:y.urls.slice(0,3)}};a=await (0,l.ko)(e)}else{let e={model:"sora-2",prompt:y.prompt,url:y.url||void 0,aspectRatio:y.aspectRatio,duration:parseInt(y.duration),size:"small",webHook:S,shutProgress:!1};a=await (0,l.LV)(e)}}catch(r){let e=r instanceof Error?r.message:"Unknown error";console.error("[video/generate] Grsai API call failed:",{error:e,taskId:U.id,prompt:y.prompt.substring(0,50),grsaiHost:process.env.GRSAI_HOST||"https://grsai.dakka.com.cn",hasApiKey:!!process.env.GRSAI_API_KEY}),V&&await (0,u.Fw)(s,i.id,V),await s.from("video_tasks").update({status:"failed",error_message:e}).eq("id",U.id);let t=e;return e.includes("GRSAI_API_KEY 环境变量未配置")||e.includes("GRSAI_API_KEY environment variable not configured")?t="API Key not configured. Please check the GRSAI_API_KEY environment variable in server configuration.":e.includes("401")||e.includes("Unauthorized")?t="API Key is invalid or expired. Please check the GRSAI_API_KEY configuration.":e.includes("403")||e.includes("Forbidden")?t="API Key does not have permission to access this service. Please check the API Key configuration.":e.includes("429")||e.includes("Rate limit")?t="API request rate limit exceeded. Please try again later.":e.includes("500")||e.includes("502")||e.includes("503")?t="API service is temporarily unavailable. Please try again later.":(e.includes("fetch failed")||e.includes("连接失败")||e.includes("连接被重置")||e.includes("ECONNRESET")||e.includes("socket hang up")||e.includes("请求超时")||e.includes("Connection failed")||e.includes("Connection reset")||e.includes("Request timeout"))&&(t="Network connection issue. The system has automatically retried. If the problem persists, please check your network connection or try again later."),T({error:"Failed to call video generation API",details:t,technicalDetails:void 0},{status:500})}let N=null;if("data"in a&&a.data?.id?N=a.data.id:"id"in a&&(N=a.id),await s.from("video_tasks").update({grsai_task_id:N}).eq("id",U.id),!y.useWebhook&&"status"in a){let e;if(C)e=a.url;else{let t=a;e=t.results?.[0]?.url}if("succeeded"===a.status&&e){let o=e,n=o;if("true"===process.env.R2_AUTO_UPLOAD_VIDEOS)try{let{uploadVideoFromUrl:e}=await Promise.all([r.e(688),r.e(7192)]).then(r.bind(r,97192)),t=`videos/${U.id}.mp4`;console.log("[video/generate] Starting video upload to R2:",{taskId:U.id,originalUrl:o,r2Key:t}),n=await e(o,t),console.log("[video/generate] ✅ Video successfully uploaded to R2 with original quality:",{taskId:U.id,r2Url:n,originalUrl:o,qualityCheck:"You can verify quality at /api/video/check-quality/"+U.id})}catch(e){console.warn("[video/generate] ⚠️ Failed to upload video to R2, using original URL:",{taskId:U.id,error:e instanceof Error?e.message:String(e),fallbackUrl:o})}let l={status:"succeeded",video_url:n,completed_at:new Date().toISOString(),progress:100};if(!C&&"results"in a&&a.results?.[0]&&(l.remove_watermark=a.results[0].removeWatermark??!0,l.pid=a.results[0].pid||null),await s.from("video_tasks").update(l).eq("id",U.id),C&&t){await m(s,t,"succeeded");let{hasPack:e,rechargeRecordId:r}=await p(s,i.id);e&&r&&await f(s,i.id,r,P)}let c=(0,u.Tb)(P);await b(s,i.id,P,c,!0,E,A,U.id);let d={success:!0,status:"succeeded",video_url:n,task_id:U.id};return!C&&"results"in a&&a.results?.[0]&&(d.remove_watermark=a.results[0].removeWatermark,d.pid=a.results[0].pid),T(d)}if("failed"===a.status){console.error("[video/generate] Video generation failed:",{taskId:U.id,grsaiTaskId:a.id,failureReason:a.failure_reason,error:a.error,prompt:y.prompt.substring(0,50),progress:a.progress});let e=(0,c._)({failureReason:a.failure_reason,error:a.error,fallback:"Video generation failed because the request was rejected by the upstream service."});C&&t?(await m(s,t,"failed",a.failure_reason||a.error||"Unknown error"),"veo-pro"===P&&V&&await (0,u.Fw)(s,i.id,V)):V&&await (0,u.Fw)(s,i.id,V);let r=(0,u.Tb)(P);return await b(s,i.id,P,r,!1,E,A,U.id),await s.from("video_tasks").update({status:"failed",failure_reason:a.failure_reason||null,error_message:e.message,completed_at:new Date().toISOString()}).eq("id",U.id),T({success:!1,status:"failed",error:e.message,violation_type:e.violationType,task_id:U.id},{status:e.violationType?400:500})}}if(await s.from("video_tasks").update({status:"processing"}).eq("id",U.id),N)return T({success:!0,status:"processing",task_id:U.id,grsai_task_id:N,message:"Video generation in progress, please wait..."});return T({success:!0,status:"processing",task_id:U.id,grsai_task_id:N,message:"Video generation in progress, result will be notified via webhook..."})}catch(e){if(console.error("Failed to generate video:",e),e instanceof E.jm)return T({error:"Parameter validation failed",details:e.errors},{status:400});return T({error:"Failed to generate video",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let O=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/video/generate/route",pathname:"/api/video/generate",filename:"route",bundlePath:"app/api/video/generate/route"},resolvedPagePath:"/Users/p/Documents/GitHub/Sora-2Ai/app/api/video/generate/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:D,staticGenerationAsyncStorage:U,serverHooks:F}=O,j="/api/video/generate/route";function V(){return(0,i.patchFetch)({serverHooks:F,staticGenerationAsyncStorage:U})}},40699:(e,t,r)=>{r.d(t,{_:()=>s});let a={input_moderation:"Prompt rejected: it contains violent, adult, hateful, or illegal content. Please rewrite it in neutral, policy-compliant language.",output_moderation:"The generated video triggered output guardrails (graphic violence, nudity, or other unsafe visuals). Try a simpler, safer description.",third_party:"Blocked by intellectual-property guardrails. Avoid referencing real brands, trademarks, celebrities, or copyrighted characters."};function s({failureReason:e,error:t,msg:r,fallback:s,httpStatus:o,grsaiCode:i}={}){let n=e?.toLowerCase();if(n&&a[n])return{message:a[n],violationType:n};if(t&&/third[-\s]?party|copyright|trademark/i.test(t))return{message:a.third_party,violationType:"third_party"};if("number"==typeof i&&-22===i)return{message:"The upstream task could not be found. This request has been cancelled and any credits have been refunded automatically."};if(404===o)return{message:"Upstream service returned 404 (task not found). The task was cancelled and your credits were refunded automatically."};let l=(t||r)?.trim();if(l&&/system error|system error please try again/i.test(l))return{message:"The video generation service encountered a system error. This is usually temporary. Please try again in a few minutes. Your credits have been automatically refunded."};if(l&&/failed to generate/i.test(l))return{message:l.includes("system error")?"The video generation service encountered a system error. Please try again in a few minutes. Your credits have been automatically refunded.":`Video generation failed. ${l}. Your credits have been automatically refunded.`};let c=s||"Video generation failed because the upstream service returned an unexpected error. Please try again in a few minutes. Your credits have been automatically refunded.";return l&&(c+=` Details: ${l}`),{message:c}}},60730:(e,t,r)=>{r.d(t,{e:()=>i});var a=r(85602),s=r(71615),o=r(77658);async function i(e){let t;let r=await (0,s.cookies)(),i=e??("function"==typeof s.headers?(()=>{try{return(0,s.headers)()}catch{return}})():void 0);i&&(t="function"==typeof i.get?i.get("authorization")??void 0:Array.isArray(i)?i.find(([e])=>"authorization"===e.toLowerCase())?.[1]:Object.entries(i).find(([e])=>"authorization"===e.toLowerCase())?.[1]??void 0);let n={fetch:(e,t)=>(0,o.e)(e,t,{timeoutMs:3e4,keepAlive:!0,maxRetries:5,retryDelay:500,exponentialBackoff:!0,returnErrorResponseOnFailure:!0})};return t&&(n.headers={Authorization:t}),(0,a.l)("https://hgzpzsiafycwlqrkzbis.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhnenB6c2lhZnljd2xxcmt6YmlzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI2MTk4NzIsImV4cCI6MjA3ODE5NTg3Mn0.WdpkrSXVZVZ64bY8NXG6Bpf-w59i305F7agny6wuj_Q",{global:n,cookies:{getAll:()=>r.getAll(),setAll(e){try{e.forEach(({name:e,value:t,options:a})=>r.set(e,t,a))}catch{}}}})}},77658:(e,t,r)=>{r.d(t,{e:()=>o});var a=r(47065);function s(e){if(!(e instanceof Error))return!1;let t=(e.message||"").toLowerCase(),r=e.cause?.code;return"AbortError"===e.name||t.includes("fetch failed")||t.includes("econnreset")||t.includes("etimedout")||t.includes("timeout")||t.includes("socket")||t.includes("tls")||t.includes("other side closed")||"UND_ERR_SOCKET"===r||"ECONNRESET"===r}async function o(e,t,r={}){let o=r.timeoutMs??3e4;try{return await (0,a.J)(async()=>{let{signal:a,cleanup:i}=function(e,t){let r=new AbortController,a=setTimeout(()=>r.abort(),t),s=null;return e&&(e.aborted?(clearTimeout(a),r.abort()):(s=()=>r.abort(),e.addEventListener("abort",s,{once:!0}))),{signal:r.signal,cleanup:()=>{clearTimeout(a),e&&s&&e.removeEventListener("abort",s)}}}(t?.signal,o);try{let s=new Headers(t?.headers);return r.keepAlive&&s.set("Connection","keep-alive"),await fetch(e,{...t,signal:a,headers:s})}catch(e){throw s(e),e}finally{i()}},{maxRetries:r.maxRetries??3,retryDelay:r.retryDelay??500,exponentialBackoff:r.exponentialBackoff??!0,onRetry:r.onRetry??(()=>{})})}catch(e){if(r.returnErrorResponseOnFailure&&s(e))return new Response(JSON.stringify({error:"fetch_failed",message:e instanceof Error?e.message:String(e)}),{status:503,headers:{"content-type":"application/json"}});throw e}}},47065:(e,t,r)=>{r.d(t,{J:()=>s,delay:()=>i,withRetryQuery:()=>o});let a={maxRetries:3,retryDelay:1e3,exponentialBackoff:!0,onRetry:()=>{}};async function s(e,t={}){let r;let s={...a,...t};for(let t=0;t<=s.maxRetries;t++)try{return await e()}catch(a){if(r=a,t===s.maxRetries)throw a;let e=s.exponentialBackoff?s.retryDelay*Math.pow(2,t):s.retryDelay;s.onRetry&&a instanceof Error&&s.onRetry(t+1,a),await new Promise(t=>setTimeout(t,e))}throw r}async function o(e,t={}){return s(async()=>{let t=await e();if(t.error){let e=t.error,r=e.message||String(e);if(r.includes("ECONNRESET")||r.includes("fetch failed")||r.includes("network")||r.includes("timeout")||r.includes("ETIMEDOUT")||r.includes("socket")||r.includes("TLS"))throw e}return t},t)}async function i(e){return new Promise(t=>setTimeout(t,e))}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,7289,5972,4967,1585,2131,9606],()=>r(82148));module.exports=a})();