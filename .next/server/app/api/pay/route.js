"use strict";(()=>{var e={};e.id=1019,e.ids=[1019,6299],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3416:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>g,requestAsyncStorage:()=>_,routeModule:()=>y,serverHooks:()=>x,staticGenerationAsyncStorage:()=>v});var s={};r.r(s),r.d(s,{GET:()=>m,runtime:()=>u});var a=r(49303),i=r(88716),n=r(60670),o=r(87070),p=r(37857),d=r(76299);let u="nodejs",c=(0,p.eI)("https://hgzpzsiafycwlqrkzbis.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{persistSession:!1}}),l={starter:"https://buy.stripe.com/28EbJ14jUg2L6550Ug0kE05",creator:"https://buy.stripe.com/dRmcN55nY4k33WXfPa0kE03",studio:"https://buy.stripe.com/6oU7sL17IdUD51132o0kE06",pro:"https://buy.stripe.com/4gMcN5eYy5o70KLauQ0kE01"};async function m(e){let{searchParams:t}=new URL(e.url),r=t.get("plan")||"",s=t.get("device_id")||"",a=(t.get("email")||"").toLowerCase();if(!d.v0[r])return o.NextResponse.json({error:"invalid_plan"},{status:400});if(!s)return o.NextResponse.json({error:"missing_device_id"},{status:400});if("starter"!==r){let e=l[r];return a?o.NextResponse.redirect(`${e}?prefilled_email=${encodeURIComponent(a)}`,302):o.NextResponse.redirect(e,302)}let i=e.headers.get("x-forwarded-for")?.split(",")[0]?.trim()||e.headers.get("x-real-ip")||e.headers.get("cf-connecting-ip")||"",{count:n}=await c.from("starter_purchase_guards").select("*",{count:"exact",head:!0}).eq("device_id",s);if((n??0)>=1)return o.NextResponse.json({error:"starter_device_limit"},{status:403});let p=new Date(Date.now()-864e5).toISOString(),{count:u}=await c.from("starter_purchase_guards").select("*",{count:"exact",head:!0}).eq("ip",i).gte("created_at",p);if((u??0)>=3)return o.NextResponse.json({error:"starter_ip_limit"},{status:403});await c.from("starter_purchase_guards").insert({device_id:s,ip:i,email:a||null});let m=l.starter,y=a?`${m}?prefilled_email=${encodeURIComponent(a)}`:m;return o.NextResponse.redirect(y,302)}let y=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/pay/route",pathname:"/api/pay",filename:"route",bundlePath:"app/api/pay/route"},resolvedPagePath:"/Users/p/Documents/GitHub/Sora-2Ai/app/api/pay/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:_,staticGenerationAsyncStorage:v,serverHooks:x}=y,h="/api/pay/route";function g(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:v})}},76299:(e,t,r)=>{r.d(t,{planFromPaymentLink:()=>a,v0:()=>s});let s={starter:{planId:"starter",displayName:"Starter Access",priceUsd:4.9,paymentLinkId:"plink_1SjMNLDqGbi6No9vUku66neA",permanentCredits:0,bonusCredits:200,bonusExpiresDays:7,allowVeoPro:!1,concurrency:1,dailyCaps:{sora:6,veo_fast:1}},creator:{planId:"creator",displayName:"Creator Pack",priceUsd:39,paymentLinkId:"plink_1SRxHLDqGbi6No9vhu7i5iud",permanentCredits:2e3,bonusCredits:600,bonusExpiresDays:14,allowVeoPro:!0,concurrency:2},studio:{planId:"studio",displayName:"Studio Pack",priceUsd:99,paymentLinkId:"plink_1SmxBiDqGbi6No9v4L6dFvvK",permanentCredits:6e3,bonusCredits:1500,bonusExpiresDays:30,allowVeoPro:!0,concurrency:3},pro:{planId:"pro",displayName:"Pro Pack",priceUsd:299,paymentLinkId:"plink_1SNF1zDqGbi6No9vqtJXYMhQ",permanentCredits:2e4,bonusCredits:4e3,bonusExpiresDays:60,allowVeoPro:!0,concurrency:5}};function a(e){return Object.values(s).find(t=>t.paymentLinkId===e)??null}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,7289,5972],()=>r(3416));module.exports=s})();