"use strict";(()=>{var e={};e.id=744,e.ids=[744],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},28287:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>A,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{POST:()=>d,dynamic:()=>l,revalidate:()=>u});var o=r(49303),n=r(88716),a=r(60670),c=r(87070),i=r(49606);let l="force-dynamic",u=0;async function d(e){try{let{model:t,stream:r,messages:s,...o}=await e.json();if(!t)return c.NextResponse.json({success:!1,error:"缺少 model 参数"},{status:400});if("boolean"!=typeof r)return c.NextResponse.json({success:!1,error:"缺少 stream 参数"},{status:400});if(!Array.isArray(s)||0===s.length)return c.NextResponse.json({success:!1,error:"缺少 messages 参数或为空"},{status:400});if(!process.env.GRSAI_API_KEY)return console.error("[Chat API] GRSAI_API_KEY 未配置"),c.NextResponse.json({success:!1,error:"API Key 未配置",details:"请检查环境变量 GRSAI_API_KEY 是否已设置"},{status:500});let n=JSON.stringify({model:t,stream:r,messages:s,...o}).length;n>1e5&&console.warn("[Chat API] 请求体过大:",{size:n,model:t,messagesCount:s.length});let a={model:t,stream:r,messages:s,...o};if(r){let e=new TextEncoder,t=new ReadableStream({async start(t){try{for await(let r of(0,i.z4)(a)){let s=`data: ${JSON.stringify(r)}

`;t.enqueue(e.encode(s))}t.enqueue(e.encode("data: [DONE]\n\n")),t.close()}catch(r){let e=r instanceof Error?r.message:"未知错误";t.error(Error(e))}}});return new c.NextResponse(t,{headers:{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"}})}let l=s.find(e=>"system"===e.role),u=s.find(e=>"user"===e.role);console.log("[Chat API] 调用 createChatCompletion:",{model:a.model,stream:a.stream,messagesCount:a.messages.length,totalPromptLength:s.reduce((e,t)=>e+(t.content?.length||0),0),systemPromptPreview:l?.content?.substring(0,200)||"N/A",userPromptPreview:u?.content?.substring(0,200)||"N/A",hasApiKey:!!process.env.GRSAI_API_KEY});try{let e=await (0,i.createChatCompletion)(a);return console.log("[Chat API] 调用成功:",{model:a.model,hasChoices:!!e.choices,choicesCount:e.choices?.length||0}),c.NextResponse.json({success:!0,data:e})}catch(e){throw console.error("[Chat API] createChatCompletion 调用失败:",{error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0,model:a.model,messagesCount:a.messages.length}),e}}catch(r){console.error("[Chat API] GRSAI Chat API 错误:",{error:r instanceof Error?r.message:String(r),stack:r instanceof Error?r.stack:void 0,name:r instanceof Error?r.name:void 0});let e=r instanceof Error?r.message:"未知错误";r instanceof Error&&r.stack;let t=e;return r instanceof Error&&(r.message.includes("GRSAI_API_KEY")?t="API Key 未配置或无效，请检查环境变量 GRSAI_API_KEY":r.message.includes("超时")?t="API 请求超时，请稍后重试":r.message.includes("连接失败")&&(t="无法连接到 API 服务，请检查网络连接")),c.NextResponse.json({success:!1,error:t,details:void 0},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:"app/api/chat/route"},resolvedPagePath:"/Users/p/Documents/GitHub/Sora-2Ai/app/api/chat/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:g}=p,f="/api/chat/route";function A(){return(0,a.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}},38238:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ReflectAdapter",{enumerable:!0,get:function(){return r}});class r{static get(e,t,r){let s=Reflect.get(e,t,r);return"function"==typeof s?s.bind(e):s}static set(e,t,r,s){return Reflect.set(e,t,r,s)}static has(e,t){return Reflect.has(e,t)}static deleteProperty(e,t){return Reflect.deleteProperty(e,t)}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,9606],()=>r(28287));module.exports=s})();