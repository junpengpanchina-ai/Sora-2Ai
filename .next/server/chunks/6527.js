"use strict";exports.id=6527,exports.ids=[6527],exports.modules={53573:(r,e,s)=>{async function o(r,e,s,o){try{let{data:t,error:n}=await r.rpc("deduct_credits_from_wallet",{user_uuid:e,credits_needed:s,model_type:o});if(n)return console.error("Error deducting credits:",n),{success:!1,error:n.message};if(!t||!t.success)return{success:!1,error:t?.error||"Failed to deduct credits"};return{success:!0,bonusUsed:t.bonus_used||0,permanentUsed:t.permanent_used||0,remainingCredits:t.remaining_credits||0}}catch(r){return console.error("Error in deductCreditsFromWallet:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}async function t(r,e,s=0,o=0,t,n=!1){try{let{data:c,error:d}=await r.rpc("add_credits_to_wallet",{user_uuid:e,permanent_amount:s,bonus_amount:o,bonus_expires_at:t||null,is_starter:n});if(d)return console.error("Error adding credits:",d),{success:!1,error:d.message};if(!c||!c.success)return{success:!1,error:c?.error||"Failed to add credits"};return{success:!0}}catch(r){return console.error("Error in addCreditsToWallet:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}s.d(e,{A8:()=>o,S_:()=>t})},66527:(r,e,s)=>{s.d(e,{AP:()=>u,Fw:()=>c,Tb:()=>t,dp:()=>n,refundCreditsByVideoTaskId:()=>d});var o=s(53573);function t(r){switch(r){case"sora-2":default:return 10;case"veo-flash":return 50;case"veo-pro":return 250}}async function n(r,e,s,n,c){try{let d=c||"sora-2",u=t(d),a=await (0,o.A8)(r,e,u,d);if(!a.success)return{success:!1,error:a.error||"Insufficient credits"};let i={user_id:e,video_task_id:s,credits:u,description:n||`Video generation (${d})`,status:"completed",model_type:d},{data:l,error:f}=await r.from("consumption_records").insert(i).select().single();if(f)return console.error("Failed to create consumption record after wallet deduction:",f),{success:!0};return{success:!0,consumptionId:l.id}}catch(r){return console.error("Error in deductCredits:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}async function c(r,e,s){try{let{data:t,error:n}=await r.from("consumption_records").select("*").eq("id",s).single();if(n||!t)return{success:!1,error:"Consumption record not found"};if("refunded"===t.status)return{success:!1,error:"Credits already refunded"};let c=t.credits||0;if(c<=0)return{success:!1,error:"Invalid credits amount to refund"};let d=await (0,o.S_)(r,e,c,0,null,!1);if(!d.success)return console.error("Failed to refund credits to wallet:",d.error),{success:!1,error:d.error||"Failed to refund credits"};let{error:u}=await r.from("consumption_records").update({status:"refunded",refunded_at:new Date().toISOString()}).eq("id",s);return u&&console.error("Failed to update consumption record:",u),{success:!0}}catch(r){return console.error("Error in refundCredits:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}async function d(r,e,s){try{let{data:o,error:t}=await r.from("consumption_records").select("*").eq("user_id",e).eq("video_task_id",s).eq("status","completed").single();if(t||!o)return{success:!1,error:"Consumption record not found"};return await c(r,e,o.id)}catch(r){return console.error("Error in refundCreditsByVideoTaskId:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}async function u(r,e){try{let{data:s,error:t}=await r.from("recharge_records").insert({user_id:e,amount:3,credits:30,payment_method:"system",status:"completed",metadata:{type:"welcome_bonus"}}).select().single();if(t||!s)return console.error("Failed to create welcome bonus recharge record:",t),{success:!1,error:"Failed to create welcome bonus recharge record"};let n=await (0,o.S_)(r,e,30,0,null,!1);if(!n.success)return console.error("Failed to add welcome bonus to wallet:",n.error),{success:!1,error:n.error||"Failed to add welcome bonus to wallet"};return console.log(`[addWelcomeBonus] Successfully added 30 credits to wallet for user ${e}`),{success:!0,rechargeRecordId:s.id}}catch(r){return console.error("Error in addWelcomeBonus:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}}};