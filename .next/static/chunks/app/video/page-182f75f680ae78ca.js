(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9272,970],{1477:function(e,t,r){Promise.resolve().then(r.bind(r,7453))},7453:function(e,t,r){"use strict";r.d(t,{default:function(){return k}});var o=r(7437),a=r(2265),s=r(9376),i=r(7648),n=r(3145),l=r(2655);function d(e){let{onClose:t,showCloseButton:r=!0}=e,i=(0,s.useRouter)(),[n,l]=(0,a.useState)(!1);return(0,o.jsx)("div",{className:"bg-gradient-to-r from-blue-50/90 to-indigo-50/90 dark:from-blue-900/20 dark:to-indigo-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-4 mb-4 transition-all duration-200 ".concat(n?"opacity-0 scale-95":"opacity-100 scale-100"),children:(0,o.jsxs)("div",{className:"flex items-start gap-3",children:[(0,o.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:(0,o.jsx)("svg",{className:"w-5 h-5 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,o.jsx)("div",{className:"flex-1 min-w-0",children:(0,o.jsxs)("p",{className:"text-sm text-gray-800 dark:text-gray-200 leading-relaxed",children:[(0,o.jsx)("span",{className:"font-semibold text-blue-700 dark:text-blue-300",children:"This result may be limited by the current model."}),(0,o.jsx)("br",{}),(0,o.jsxs)("span",{className:"text-gray-700 dark:text-gray-300",children:["For higher consistency and fewer retries,"," ",(0,o.jsxs)("button",{onClick:()=>{i.push("/?pricing=1&model=veo-pro")},className:"font-medium text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 underline inline-flex items-center gap-1",children:["Veo Pro",(0,o.jsx)("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})," ","is usually a better choice for this type of scene."]})]})}),r&&(0,o.jsx)("button",{onClick:()=>{t&&(l(!0),setTimeout(()=>{t(),l(!1)},200))},className:"flex-shrink-0 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors","aria-label":"Close recommendation",children:(0,o.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})}function c(e){let{onRefine:t,onUpgrade:r,prompt:i}=e,n=(0,s.useRouter)(),[l,d]=(0,a.useState)(!1),[c,u]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{let e=setTimeout(()=>{d(!0)},2e3),t=setTimeout(()=>{u(!0)},4e3);return()=>{clearTimeout(e),clearTimeout(t)}},[]),l)?(0,o.jsxs)("div",{className:"mt-4 space-y-3",children:[l&&!c&&(0,o.jsx)("div",{className:"rounded-lg bg-green-50/90 dark:bg-green-900/20 border border-green-200 dark:border-green-800 p-3",children:(0,o.jsx)("p",{className:"text-sm text-green-800 dark:text-green-200",children:"This preview helps validate the idea."})}),c&&(0,o.jsxs)("div",{className:"rounded-xl bg-gradient-to-r from-blue-50/90 to-indigo-50/90 dark:from-blue-900/20 dark:to-indigo-900/20 border border-blue-200 dark:border-blue-800 p-4",children:[(0,o.jsx)("p",{className:"text-sm font-medium text-gray-800 dark:text-gray-200 mb-3",children:"Next step options:"}),(0,o.jsxs)("div",{className:"space-y-2",children:[(0,o.jsx)("button",{onClick:()=>{t&&t()},className:"w-full rounded-lg bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-4 py-2.5 text-sm font-medium transition-all shadow-md hover:shadow-lg",children:"Refine this preview"}),(0,o.jsx)("button",{onClick:()=>{r?r():n.push("/video?model=veo3.1-pro")},className:"w-full rounded-lg bg-white dark:bg-gray-800 border-2 border-blue-300 dark:border-blue-700 hover:border-blue-400 dark:hover:border-blue-600 text-blue-700 dark:text-blue-300 px-4 py-2.5 text-sm font-medium transition-all",children:"Generate final-quality video (Veo Pro)"})]}),(0,o.jsx)("p",{className:"mt-3 text-xs text-gray-600 dark:text-gray-400 text-center",children:"Many creators start with a preview before moving to final production."})]})]}):null}function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};fetch("/api/track",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,props:t,timestamp:Date.now()}),keepalive:!0}).catch(()=>{})}let m={AFTER_SORA_2:{title:"Want a higher-fidelity version of the same scene?",body:"Many creators draft ideas with Sora, then upgrade the best take for a more realistic final cut.",cta:"Upgrade this render to Veo Pro"},REMIX_3:{title:"This looks ready for a final export",body:"If motion and realism matter for publishing, Veo Pro is commonly used for the final version.",cta:"Render once in Veo Pro"},EXPORT_CLICK:{title:"Before you export",body:"Some teams draft with Sora and export the final in Veo Pro for the best result.",cta:"Final export with Veo Pro"},BONUS_NEAR_EMPTY:{title:"Keep creating without interruptions",body:"Your bonus window is nearly used. A Creator pack keeps credits permanently, with extra bonus for the next days.",cta:"Get Creator (Recommended)"}};function h(e){let t=(0,s.useRouter)(),[r,i]=(0,a.useState)(!1),n=(0,a.useMemo)(()=>e.exportIntent?"EXPORT_CLICK":e.remixSamePrompt24h>=3?"REMIX_3":e.soraRenders7d>=2&&e.soraRenders7d<3?"AFTER_SORA_2":e.bonusUsageRatio>=.8?"BONUS_NEAR_EMPTY":null,[e.soraRenders7d,e.remixSamePrompt24h,e.bonusUsageRatio,e.exportIntent]);if((0,a.useEffect)(()=>{n&&(u("upgrade_nudge_shown",{trigger_type:n,sora_renders_7d:e.soraRenders7d,remix_count_24h:e.remixSamePrompt24h,bonus_usage_ratio:e.bonusUsageRatio}),i(!0))},[n,e]),!r||!n)return null;let l=m[n],d=()=>{u("upgrade_nudge_dismissed",{trigger_type:n}),e.onDismiss(),i(!1)};return(0,o.jsxs)("div",{className:"mt-4 rounded-2xl border border-white/10 bg-white/5 p-4 backdrop-blur-sm",children:[(0,o.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsx)("div",{className:"text-sm font-semibold text-white",children:l.title}),(0,o.jsx)("div",{className:"mt-1 text-sm text-white/80 leading-relaxed",children:l.body})]}),(0,o.jsx)("button",{className:"flex-shrink-0 text-xs text-white/60 hover:text-white/80 transition-colors",onClick:d,"aria-label":"Dismiss",children:"Not now"})]}),(0,o.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,o.jsx)("button",{className:"flex-1 rounded-xl bg-gradient-to-r from-[#1f75ff] to-[#3f8cff] px-4 py-2 text-sm font-semibold text-white hover:opacity-90 transition-opacity",onClick:()=>{if(u("upgrade_nudge_clicked",{trigger_type:n,action:"upgrade"}),"BONUS_NEAR_EMPTY"===n)t.push("/?pricing=1");else{let r=new URLSearchParams;e.prompt&&r.set("prompt",e.prompt),e.aspectRatio&&r.set("aspect",e.aspectRatio),r.set("model","veo-pro"),t.push("/video?".concat(r.toString()))}e.onUpgradeToVeoPro(),i(!1)},children:l.cta}),"BONUS_NEAR_EMPTY"!==n&&(0,o.jsx)("button",{className:"rounded-xl border border-white/15 px-4 py-2 text-sm text-white/80 hover:bg-white/5 transition-colors",onClick:()=>{t.push("/?pricing=1"),d()},children:"See plans"})]})]})}var p=r(1509);let g={after_2_sora_renders:{title:"Ready for a cleaner final export?",body:"Sora is great for drafts. When you&apos;re happy with the idea, Veo Pro can improve motion realism and detail for the version you ship.",primary:"Upgrade this render with Veo Pro",secondary:"Keep drafting with Sora"},export_click:{title:"Exporting this one?",body:"For the final cut, Veo Pro typically delivers smoother motion and higher fidelity.",primary:"Upgrade to Veo Pro for final export",secondary:"Export as-is"},quality_intent_click:{title:"Want higher fidelity?",body:"Veo Pro is built for final delivery — sharper details and more realistic motion.",primary:"Try Veo Pro",secondary:"Not now"},high_iteration:{title:"Iterating fast — nice.",body:"When you land on the version you&apos;ll publish, Veo Pro helps make the final cut look cleaner.",primary:"Upgrade the final cut with Veo Pro",secondary:"Keep iterating"},prompt_high_intent:{title:"Making something commercial?",body:"For ads, product shots, and client work, Veo Pro is the best choice for final delivery quality.",primary:"Use Veo Pro for this render",secondary:"Continue with Sora"},veo_locked_click:{title:"Veo Pro is available on paid packs.",body:"Starter is designed for testing the workflow. Upgrade to unlock Veo Pro and higher limits.",primary:"See pricing",secondary:"Keep using Sora"},commercial_format:{title:"If this is the version you&apos;re publishing",body:"Veo Pro can deliver a cleaner final cut with smoother motion and higher fidelity.",primary:"Upgrade to Veo Pro",secondary:"Keep drafting"},retry_same_prompt_3:{title:"If this is the version you&apos;re publishing",body:"Veo Pro can deliver a cleaner final cut with smoother motion and higher fidelity.",primary:"Upgrade to Veo Pro",secondary:"Keep drafting"}};function x(e){let{planId:t,soraRendersThisSession:r,promptText:s,onUpgrade:i,onDismiss:n}=e,[l,d]=(0,a.useState)(!1),[c,u]=(0,a.useState)(null),m=(0,a.useMemo)(()=>"pro"!==t&&"studio"!==t,[t]);if((0,a.useEffect)(()=>{m&&(2===r&&(u("after_2_sora_renders"),d(!0)),function(e){if(!e)return!1;let t=e.toLowerCase();return["commercial","client","ad","marketing","product launch","brand"].some(e=>t.includes(e))}(s)&&r>=1&&(u("prompt_high_intent"),d(!0)))},[m,r,s]),(0,a.useEffect)(()=>{l&&c&&(0,p.j)("upsell_nudge_view",{trigger:c,planId:t})},[l,c,t]),!l||!c)return null;let h=g[c];return h?(0,o.jsx)("div",{className:"fixed bottom-4 left-0 right-0 z-50 mx-auto max-w-xl px-4",children:(0,o.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-5 shadow-lg backdrop-blur-sm",children:[(0,o.jsx)("div",{className:"text-sm font-semibold text-white",children:h.title}),(0,o.jsx)("div",{className:"mt-2 text-sm text-white/80",children:h.body}),"starter"===t&&"veo_locked_click"===c?(0,o.jsx)("div",{className:"mt-2 text-xs text-white/60",children:"Starter is designed for testing the workflow. Upgrade to unlock Veo Pro and higher limits."}):null,(0,o.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,o.jsx)("button",{className:"flex-1 rounded-xl bg-gradient-to-r from-[#1f75ff] to-[#3f8cff] px-4 py-2.5 text-sm font-semibold text-white hover:opacity-90 transition-opacity",onClick:()=>{(0,p.j)("upsell_nudge_accept",{trigger:c,planId:t}),i(),d(!1)},children:h.primary}),(0,o.jsx)("button",{className:"rounded-xl border border-white/20 px-4 py-2.5 text-sm font-semibold text-white/80 hover:bg-white/5 transition-colors",onClick:()=>{(0,p.j)("upsell_nudge_dismiss",{trigger:c,planId:t}),d(!1),null==n||n()},children:h.secondary})]})]})}):null}var f=r(970),b=r(3426);let v={input_moderation:{headline:"Prompt rejected by safety filters",description:"The text prompt contains violent, adult, hateful, or illegal content. Please rewrite your idea using neutral, policy-compliant language.",suggestions:["Remove explicit, graphic, or hateful details","Avoid requests related to weapons, drugs, or unlawful behavior","Describe original characters or scenes instead of real people"]},output_moderation:{headline:"Generated output triggered guardrails",description:"The model stopped because the resulting video contained unsafe visuals (graphic violence, nudity, or other disallowed scenes). Try a simpler and safer description.",suggestions:["Tone down graphic or shocking details","Avoid referencing gore, injuries, or adult situations","Focus on the creative mood or setting instead of intense actions"]},third_party:{headline:"Blocked by intellectual-property guardrails",description:"The request referenced real brands, celebrities, or copyrighted characters. Please use original names and fictional concepts.",suggestions:["Invent fictional brands or characters","Describe visual styles instead of specific franchises","Avoid logos, trademarks, and protected artworks"]}},w=e=>{if(e&&("input_moderation"===e||"output_moderation"===e||"third_party"===e))return e};function y(){let[e,t]=(0,a.useState)(null),r=(0,s.useRouter)(),u=(0,s.useSearchParams)(),[m,p]=(0,a.useState)(""),[g,y]=(0,a.useState)(!1),[k,j]=(0,a.useState)(""),[N,S]=(0,a.useState)("9:16"),[P,_]=(0,a.useState)("10"),[I,V]=(0,a.useState)(!1),[C,R]=(0,a.useState)("sora-2"),[T,U]=(0,a.useState)(""),[E,L]=(0,a.useState)(""),[D,W]=(0,a.useState)(!1),[A,F]=(0,a.useState)(null),[M,O]=(0,a.useState)(null),[G,q]=(0,a.useState)(""),[B,z]=(0,a.useState)(null),[K,Y]=(0,a.useState)(null),[J,X]=(0,a.useState)(!1),[Z,H]=(0,a.useState)(null),[Q,$]=(0,a.useState)(0),[ee,et]=(0,a.useState)(!1),[er,eo]=(0,a.useState)(null),ea=(0,a.useRef)(!1),es=(0,a.useRef)(!0),[ei,en]=(0,a.useState)(!1),[el,ed]=(0,a.useState)(!1),[ec,eu]=(0,a.useState)(0),[em,eh]=(0,a.useState)(null),[ep,eg]=(0,a.useState)(!1),ex=(0,a.useRef)(null),[ef,eb]=(0,a.useState)(0),[ev,ew]=(0,a.useState)(!1),[ey]=(0,a.useState)(()=>"session_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))),[ek,ej]=(0,a.useState)(0),[eN,eS]=(0,a.useState)(void 0),[eP,e_]=(0,a.useState)(0),[eI,eV]=(0,a.useState)(0),eC=(0,a.useRef)(null),[eR,eT]=(0,a.useState)(null),eU=m.replace(/^create\s+a\s+professional\s+create\s+a\s+professional\s+/i,"Create a professional ").replace(/\s+/g," ").trim(),eE=g&&(!eU||eU.length<5)?"Please enter at least ".concat(5," characters (currently ").concat(eU.length,")."):null,eL=!!e&&!D&&!!eU&&eU.length>=5;(0,a.useEffect)(()=>{let e=(0,f.createClient)();return t(e),es.current=!0,e.auth.getUser().then(e=>{let{data:{user:t}}=e;t&&eS(t.id)}).catch(()=>{}),()=>{es.current=!1}},[]);let eD=(0,a.useCallback)(async()=>{if(!e)return{};let{data:{session:t}}=await e.auth.getSession();return(null==t?void 0:t.access_token)?{Authorization:"Bearer ".concat(t.access_token)}:{}},[e]);(0,a.useEffect)(()=>{e&&es.current&&async function(){try{let e=await eD(),t=await fetch("/api/user/entitlements",{headers:e});if(t.ok){let e=await t.json();e.success&&e.entitlements&&eT({planId:e.entitlements.planId||"free",veoProEnabled:e.entitlements.veoProEnabled||!1})}}catch(e){console.error("Failed to fetch entitlements:",e)}}()},[e,eD]),(0,a.useEffect)(()=>{if(!e||!es.current)return;async function t(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(es.current)try{let r=new AbortController,o=setTimeout(()=>r.abort(),2e4),a=await fetch("/api/stats",{headers:await eD(),signal:r.signal});if(clearTimeout(o),!es.current)return;if(a.ok){let e=await a.json();e.success&&void 0!==e.credits&&es.current&&z(e.credits)}else if(a.status>=500&&e<3){let r=1e3*Math.pow(2,e);console.warn("[VideoPage] Stats API returned ".concat(a.status,", retrying in ").concat(r,"ms...")),setTimeout(()=>t(e+1),r)}}catch(r){if(r instanceof Error&&"AbortError"===r.name)console.warn("[VideoPage] Stats API request timeout");else if(e<3){let o=1e3*Math.pow(2,e);console.warn("[VideoPage] Failed to fetch credits, retrying in ".concat(o,"ms..."),r),setTimeout(()=>t(e+1),o)}else console.error("Failed to fetch credits after retries:",r)}}t();let r=setInterval(()=>{es.current?t():clearInterval(r)},3e4);return()=>clearInterval(r)},[eD,e]),(0,a.useEffect)(()=>{e&&es.current&&t();async function t(){try{let e=await eD(),t=await fetch("/api/payment/recharge-records",{headers:e});if(t.ok){let e=await t.json();if(e.success){let t=e.records&&e.records.length>0;Y(t)}}}catch(e){console.error("Failed to check recharge records:",e)}}},[e,eD]),(0,a.useEffect)(()=>{null!==B&&null!==K&&X(!K&&B<=30)},[B,K]),(0,a.useEffect)(()=>{if(ea.current||!es.current)return;let e=u.get("prompt");if(e){p(e.replace(/^create\s+a\s+professional\s+create\s+a\s+professional\s+/i,"Create a professional ").replace(/\s+/g," ").trim()),y(!0),ea.current=!0;let t=setTimeout(()=>{if(es.current)try{let e=new URL(window.location.href);e.searchParams.delete("prompt"),window.history.replaceState({...window.history.state,as:e.pathname+e.search,url:e.pathname+e.search},"",e.pathname+e.search)}catch(e){console.debug("[VideoPage] Failed to update URL (safe to ignore):",e)}},100);return()=>{clearTimeout(t)}}},[u,r]),(0,a.useEffect)(()=>{if(!M||!es.current)return;let e=0,t=setInterval(async()=>{if(!es.current){clearInterval(t);return}try{let r;console.log("[VideoPage] \uD83D\uDD0D Polling task status:",{taskId:M});let o=new AbortController,a=setTimeout(()=>o.abort(),1e4);try{r=await fetch("/api/video/result/".concat(M),{headers:await eD(),signal:o.signal}),clearTimeout(a)}catch(r){clearTimeout(a),r instanceof Error&&"AbortError"===r.name?console.warn("[VideoPage] ⚠️ Polling request timeout:",{taskId:M}):r instanceof TypeError&&r.message.includes("Failed to fetch")?console.warn("[VideoPage] ⚠️ Network error during polling:",{taskId:M,error:r.message}):console.error("[VideoPage] ❌ Unexpected error during polling:",{taskId:M,error:r instanceof Error?r.message:String(r)}),++e>=5&&(console.error("[VideoPage] ❌ Too many consecutive polling errors, stopping:",{taskId:M,consecutiveErrors:e}),clearInterval(t),es.current&&(F(e=>({...null!=e?e:{task_id:M,prompt:G},task_id:M,status:"failed",error:"Network connection error. Please check your internet connection and try refreshing the page.",prompt:(null==e?void 0:e.prompt)||G})),O(null)));return}if(!es.current){clearInterval(t);return}if(e=0,console.log("[VideoPage] \uD83D\uDCE5 Polling response:",{taskId:M,status:r.status,ok:r.ok}),!r.ok){if(console.error("[VideoPage] ❌ Polling response not OK:",{taskId:M,status:r.status,statusText:r.statusText}),404===r.status){clearInterval(t),es.current&&(F(e=>({...null!=e?e:{task_id:M,prompt:G},task_id:M,status:"failed",error:"Task not found. Please try generating a new video.",prompt:(null==e?void 0:e.prompt)||G})),O(null));return}++e>=5&&(clearInterval(t),es.current&&(F(e=>({...null!=e?e:{task_id:M,prompt:G},task_id:M,status:"failed",error:"Server error (".concat(r.status,"). Please try again later."),prompt:(null==e?void 0:e.prompt)||G})),O(null)));return}let s=await r.json();if(console.log("[VideoPage] \uD83D\uDCE6 Polling data:",{taskId:M,success:s.success,status:s.status,progress:s.progress,hasVideoUrl:!!s.video_url,hasError:!!s.error,error:s.error,violationType:s.violation_type}),!es.current){clearInterval(t);return}if(s.success)F(e=>({...null!=e?e:{task_id:M,prompt:G},task_id:M,status:s.status,progress:s.progress,video_url:s.video_url,remove_watermark:s.remove_watermark,pid:s.pid,prompt:(null==e?void 0:e.prompt)||G,error:void 0,violationType:void 0})),("succeeded"===s.status||"failed"===s.status)&&(console.log("[VideoPage] ✅ Polling completed:",{taskId:M,finalStatus:s.status}),O(null));else if("failed"===s.status){let e=s.error||s.details||"Video generation failed",t=e.includes("system error")||e.includes("temporary")?"The video generation service encountered a system error. This is usually temporary. Please try again in a few minutes. Your credits have been automatically refunded.":e;console.error("[VideoPage] ❌ Task failed during polling:",{taskId:M,error:e,friendlyError:t,violationType:s.violation_type,details:s.details,fullResponse:s}),es.current&&(F(e=>{var r;return{...null!=e?e:{task_id:M,prompt:G},task_id:M,status:"failed",error:t,progress:null!==(r=s.progress)&&void 0!==r?r:null==e?void 0:e.progress,prompt:(null==e?void 0:e.prompt)||G,violationType:w(s.violation_type)}}),"veo-pro"!==C&&($(e=>e+1),et(!0)),O(null))}}catch(r){console.error("[VideoPage] ❌ Failed to poll task ".concat(M,":"),{error:r instanceof Error?r.message:String(r),stack:r instanceof Error?r.stack:void 0,taskId:M}),++e>=5&&(console.error("[VideoPage] ❌ Too many consecutive errors, stopping polling:",{taskId:M,consecutiveErrors:e}),clearInterval(t),es.current&&(F(e=>({...null!=e?e:{task_id:M,prompt:G},task_id:M,status:"failed",error:"Failed to check task status. Please refresh the page and try again.",prompt:(null==e?void 0:e.prompt)||G})),O(null)))}},3e3);return()=>clearInterval(t)},[M,G,eD]);let eW=async t=>{if(t.preventDefault(),$(0),et(!1),eb(0),ew(!1),"sora-2"===C&&(ej(e=>e+1),e_(e=>e+1),eC.current&&eC.current===eU?eV(e=>e+1):(eV(1),eC.current=eU)),!e){console.error("[VideoPage] ❌ Supabase client not initialized");return}W(!0);try{var o,a,s;let e;if(y(!0),!eU||eU.length<5){console.warn("[VideoPage] ⚠️ Prompt too short:",{cleanedLength:eU.length,minLength:5}),W(!1);return}let t={prompt:eU,aspectRatio:N,useWebhook:I,model:C};"sora-2"===C?(t.url=k||void 0,t.duration=P):(T&&(t.firstFrameUrl=T),E&&(t.lastFrameUrl=E),k&&(t.urls=[k])),console.log("[VideoPage] \uD83D\uDCE4 Starting video generation request:",{prompt:m.substring(0,50)+(m.length>50?"...":""),hasReferenceUrl:!!k,aspectRatio:N,duration:P,useWebhook:I});let i=await eD(),n=new AbortController,l=setTimeout(()=>n.abort(),6e4);try{e=await fetch("/api/video/generate",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8",...i},body:JSON.stringify(t),signal:n.signal}),clearTimeout(l)}catch(e){if(clearTimeout(l),e instanceof Error&&"AbortError"===e.name){console.error("[VideoPage] ❌ Request timeout:",{error:"Request took too long"}),alert("Request timeout. Please check your network connection and try again."),W(!1);return}if(e instanceof TypeError&&e.message.includes("Failed to fetch")){console.error("[VideoPage] ❌ Network error:",{error:e.message}),alert("Network error. Please check your internet connection and try again."),W(!1);return}console.error("[VideoPage] ❌ Unexpected error:",{error:e}),alert("An unexpected error occurred. Please try again."),W(!1);return}if(console.log("[VideoPage] \uD83D\uDCE5 Received response:",{status:e.status,statusText:e.statusText,ok:e.ok}),401===e.status){console.warn("[VideoPage] ⚠️ Unauthorized (401), redirecting to login");let e="".concat(window.location.pathname).concat(window.location.search);(0,b.Ko)(e),r.push("/login?redirect=".concat(encodeURIComponent(e)));return}let d=await e.json();console.log("[VideoPage] \uD83D\uDCE6 Response data:",{success:d.success,status:d.status,hasError:!!d.error,error:d.error,details:d.details,taskId:d.task_id,violationType:d.violation_type});let c=w(d.violation_type);if(d.success){let e=await fetch("/api/stats",{headers:await eD()});if(e.ok){let t=await e.json();t.success&&void 0!==t.credits&&z(t.credits)}"succeeded"===d.status&&d.video_url?(console.log("[VideoPage] ✅ Video generation completed immediately:",{taskId:d.task_id,videoUrl:d.video_url}),F({task_id:d.task_id||"",status:"succeeded",video_url:d.video_url,remove_watermark:d.remove_watermark,pid:d.pid,prompt:m,violationType:void 0})):"processing"===d.status&&d.task_id&&(console.log("[VideoPage] \uD83D\uDD04 Video generation in progress, starting polling:",{taskId:d.task_id,progress:null!==(o=d.progress)&&void 0!==o?o:0}),q(m),F({task_id:d.task_id,status:"processing",progress:null!==(a=d.progress)&&void 0!==a?a:0,prompt:m,violationType:void 0}),O(d.task_id)),p(""),y(!1),j("")}else{let o=d.error||"Unknown error",a=d.details||"",i=d.technicalDetails||"";console.error("[VideoPage] ❌ Video generation failed:",{error:o,details:a,technicalDetails:i,status:d.status,taskId:d.task_id,violationType:c,fullResponse:d});let n=!0;if(o.includes("Insufficient credits")||o.includes("credits")){console.warn("[VideoPage] ⚠️ Insufficient credits");let e=!K&&null!==B&&B<=30?"You're out of credits! Try the $4.9 starter pack (10 videos) or upgrade to larger packs. Current credits: ".concat(B||0,"."):"Insufficient credits! Video generation requires 10 credits. Current credits: ".concat(B||0,". Please recharge first.");alert(e);let t="".concat(window.location.pathname).concat(window.location.search);(0,b.Ko)(t),r.push("/?pricing=1&redirect=".concat(encodeURIComponent(t)))}else o.includes("User not found")?(console.error("[VideoPage] ❌ User not found"),alert("User not found: ".concat(a||"Please try logging in again","\n\nIf the problem persists, please contact support."))):c?(console.warn("[VideoPage] ⚠️ Content violation detected:",c),F({task_id:d.task_id||"",status:"failed",error:o,prompt:m,progress:null!==(s=d.progress)&&void 0!==s?s:0,violationType:c}),n=!1):(console.error("[VideoPage] ❌ Generation failed - Full error details:",{errorMessage:o,errorDetails:a,technicalDetails:i,httpStatus:e.status,responseData:d,requestBody:t}),"veo-pro"!==C&&($(e=>e+1),et(!0)),alert("Generation failed: ".concat(o).concat(a?"\n\n"+a:"")));n&&F(null)}}catch(e){console.error("[VideoPage] ❌ Exception during video generation:",{error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0,name:e instanceof Error?e.name:void 0}),alert("Failed to generate video, please try again later")}finally{W(!1),console.log("[VideoPage] ✅ Video generation request completed (loading set to false)")}},eA=async t=>{if(!e){alert("Please sign in first.");return}if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(t.type)){alert("Unsupported file format. Please upload a JPG, JPEG, PNG, or WEBP image.");return}if(t.size>10485760){alert("File is too large. Maximum supported size is 10MB.");return}ed(!0),eu(0);let o=URL.createObjectURL(t);eh(o);try{let e=new FormData;e.append("file",t),e.append("folder","reference-images");let a=await fetch("/api/storage/upload",{method:"POST",body:e});if(401===a.status){alert("Unauthorized. Please sign in first.");let e="".concat(window.location.pathname).concat(window.location.search);(0,b.Ko)(e),r.push("/login?redirect=".concat(encodeURIComponent(e))),URL.revokeObjectURL(o),eh(null);return}let s=await a.json();if(!a.ok||!s.success)throw Error(s.error||"Upload failed.");j(s.file.url),eh(s.file.url),eu(100),eg(!1),URL.revokeObjectURL(o)}catch(e){console.error("Image upload failed:",e),alert(e instanceof Error?e.message:"Upload failed. Please try again."),URL.revokeObjectURL(o),eh(null),eg(!1)}finally{ed(!1),eu(0)}},eF=(null==A?void 0:A.violationType)?v[A.violationType]:null;return(0,o.jsxs)("div",{className:"relative min-h-screen overflow-hidden text-white bg-[#050b18]",children:[(0,o.jsx)("div",{className:"cosmic-space absolute inset-0","aria-hidden":"true"}),(0,o.jsx)("div",{className:"cosmic-glow absolute inset-0","aria-hidden":"true"}),(0,o.jsx)("div",{className:"cosmic-stars absolute inset-0","aria-hidden":"true"}),(0,o.jsx)("div",{className:"cosmic-noise absolute inset-0","aria-hidden":"true"}),(0,o.jsxs)("div",{className:"relative z-10 cosmic-content",children:[(0,o.jsx)("nav",{className:"border-b border-white/10 bg-white/5 backdrop-blur-lg",children:(0,o.jsx)("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:(0,o.jsxs)("div",{className:"flex h-16 items-center justify-between",children:[(0,o.jsxs)("div",{className:"flex items-center gap-4",children:[(0,o.jsx)(i.default,{href:"/",className:"text-xl font-bold text-white",children:"Sora2Ai Videos"}),(0,o.jsx)(i.default,{href:"/video",className:"text-sm font-medium text-energy-water",children:"Video Generation"})]}),(0,o.jsxs)("div",{className:"flex items-center gap-4",children:[null!==B&&(0,o.jsx)("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-energy-water-surface dark:bg-energy-water-muted",children:(0,o.jsxs)("span",{className:"text-sm font-medium text-energy-water dark:text-energy-soft",children:["Credits: ",B]})}),(0,o.jsx)(i.default,{href:"/",className:"text-sm font-medium text-blue-100 transition-colors hover:text-white",children:"Home"}),(0,o.jsx)(i.default,{href:"/prompts",className:"text-sm font-medium text-blue-100 transition-colors hover:text-white",children:"Prompts"}),(0,o.jsx)(l.Z,{})]})]})})}),(0,o.jsxs)("div",{className:"mx-auto max-w-7xl px-4 py-12 sm:px-6 lg:px-8",children:[(0,o.jsx)("div",{className:"mb-8",children:m&&m.trim()?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h1",{className:"text-4xl font-bold text-white mb-2",children:"Create a Quick Video Preview"}),(0,o.jsx)("p",{className:"text-lg text-blue-100/80 mb-4",children:"Start with a fast visual draft to explore your idea."}),(0,o.jsxs)("div",{className:"mt-4 p-4 rounded-xl bg-white/5 border border-white/10",children:[(0,o.jsxs)("p",{className:"text-sm text-blue-100/70 mb-2",children:[(0,o.jsx)("strong",{className:"text-white",children:"Video Concept:"})," ",m]}),(0,o.jsx)("p",{className:"text-xs text-blue-100/50",children:"This page is dedicated to generating a video based on your specific prompt. Each video generated from this prompt will be unique, created using advanced AI technology."})]})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h1",{className:"text-4xl font-bold text-white mb-2",children:"Sora-2 Video Generation"}),(0,o.jsx)("p",{className:"text-lg text-blue-100/80",children:"Generate high-quality videos using OpenAI Sora 2.0 model"})]})}),J&&(0,o.jsx)("div",{className:"mb-6 rounded-2xl border-2 border-energy-water/50 bg-gradient-to-r from-energy-water/20 via-energy-water/10 to-transparent p-6 shadow-[0_25px_80px_-45px_rgba(33,122,255,0.5)] backdrop-blur-xl",children:(0,o.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsx)("h3",{className:"text-xl font-bold text-white mb-2",children:"\uD83C\uDF89 Get Started with 10 More AI Videos for $4.9"}),(0,o.jsx)("p",{className:"text-blue-100/90 text-sm sm:text-base",children:"Perfect for new users! Get 100 credits (10 videos) with our starter pack. Try it now and continue creating amazing videos."})]}),(0,o.jsx)("button",{onClick:()=>{let e=window.location.href;(0,b.Ko)(e),r.push("/#pricing-plans")},className:"whitespace-nowrap rounded-xl bg-gradient-to-r from-energy-water to-energy-water-deep px-6 py-3 text-sm font-semibold text-white shadow-lg transition-transform hover:scale-105 hover:brightness-110 focus:outline-none focus:ring-2 focus:ring-energy-water focus:ring-offset-2 focus:ring-offset-transparent",children:"Go to Starter Pack →"})]})}),(0,o.jsxs)("div",{className:"mb-8 rounded-2xl border border-white/10 bg-white/5 p-6 shadow-[0_25px_80px_-45px_rgba(0,0,0,0.85)] backdrop-blur-xl",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,o.jsx)("h2",{className:"text-xl font-semibold text-white",children:m&&m.trim()?"Modify or Generate Video":"Create New Task"}),null!==B&&(0,o.jsxs)("div",{className:"text-sm text-blue-100/80",children:["sora-2"===C&&(0,o.jsx)("span",{className:"text-blue-100/70",children:"Preview credits are used for exploration. Unused credits remain available."}),"sora-2"!==C&&(0,o.jsxs)("span",{children:["veo-flash"===C&&"This generation uses Flash credits (50 credits).","veo-pro"===C&&"This generation uses Pro credits (250 credits)."]})]})]}),(0,o.jsxs)("form",{onSubmit:eW,className:"space-y-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsxs)("label",{className:"mb-2 block text-sm font-medium text-blue-100/80",children:["Prompt ",(0,o.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,o.jsx)("textarea",{value:m,onChange:e=>{y(!0),p(e.target.value)},required:!0,rows:4,className:"w-full rounded-2xl border border-white/15 bg-white/5 px-3 py-2 text-white placeholder:text-blue-100/50 shadow-lg backdrop-blur-sm focus:border-energy-water focus:outline-none focus:ring-2 focus:ring-energy-water",placeholder:"e.g., A cute cat playing on the grass"}),(0,o.jsxs)("div",{className:"mt-2 flex items-center justify-between",children:[(0,o.jsx)("p",{className:"text-xs ".concat(eE?"text-red-300":"text-blue-100/50"),children:null!=eE?eE:"Tip: prompts work best with more detail. Minimum ".concat(5," characters.")}),(0,o.jsxs)("p",{className:"text-xs text-blue-100/50",children:[eU.length,"/",5,"+"]})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"mb-2 block text-sm font-medium text-blue-100/80",children:"Reference Image (Optional)"}),(0,o.jsxs)("div",{onDragOver:e=>{e.preventDefault(),e.stopPropagation(),en(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),en(!1)},onDrop:e=>{e.preventDefault(),e.stopPropagation(),en(!1);let t=e.dataTransfer.files;t.length>0&&eA(t[0])},onClick:()=>{var e;null===(e=ex.current)||void 0===e||e.click()},className:"relative mb-3 cursor-pointer rounded-2xl border-2 border-dashed transition-all ".concat(ei?"border-energy-water bg-energy-water/10":"border-white/20 bg-white/5 hover:border-white/30 hover:bg-white/10"," ").concat(el?"pointer-events-none opacity-50":""),children:[(0,o.jsx)("input",{ref:ex,type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:e=>{let t=e.target.files;t&&t.length>0&&eA(t[0]),ex.current&&(ex.current.value="")},className:"hidden",disabled:el}),(0,o.jsx)("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:!em||el||ep?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("svg",{className:"mb-4 h-12 w-12 text-blue-100/50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,o.jsx)("p",{className:"mb-2 text-sm font-medium text-blue-100/80",children:el?"Uploading...":"Click to upload image"}),(0,o.jsx)("p",{className:"text-xs text-blue-100/50",children:"Or drag and drop images here"}),(0,o.jsx)("p",{className:"mt-2 text-xs text-blue-100/40",children:"Supports JPG, JPEG, PNG, WEBP formats"}),el&&(0,o.jsx)("div",{className:"mt-4 w-full max-w-xs",children:(0,o.jsx)("div",{className:"h-2 w-full overflow-hidden rounded-full bg-white/10",children:(0,o.jsx)("div",{className:"h-full rounded-full bg-energy-water transition-all duration-300",style:{width:"".concat(ec,"%")}})})})]}):(0,o.jsxs)("div",{className:"relative w-full h-48 flex items-center justify-center",children:[(0,o.jsx)("div",{className:"relative w-full h-full max-w-full",children:em.startsWith("blob:")?(0,o.jsx)("img",{src:em,alt:"Preview",className:"mx-auto max-h-48 w-auto rounded-lg object-contain",onError:()=>{eg(!0),eh(null)}}):(0,o.jsx)(n.default,{src:em,alt:"Preview",fill:!0,className:"object-contain rounded-lg",onError:()=>{eg(!0),eh(null)}})}),(0,o.jsx)("button",{onClick:e=>{e.stopPropagation(),eh(null),j(""),eg(!1)},className:"absolute right-0 top-0 z-10 rounded-full bg-red-500 p-1 text-white hover:bg-red-600",title:"Remove image",children:(0,o.jsx)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})]}),(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)("input",{type:"url",value:k,onChange:e=>{let t=e.target.value;j(t),eg(!1),t&&t.startsWith("http")?eh(t):t||eh(null)},className:"w-full rounded-2xl border border-white/15 bg-white/5 px-3 py-2 text-white placeholder:text-blue-100/50 shadow-lg backdrop-blur-sm focus:border-energy-water focus:outline-none focus:ring-2 focus:ring-energy-water",placeholder:"Or enter image URL directly (e.g., https://example.com/image.png)"}),k&&(0,o.jsx)("button",{onClick:()=>{j(""),eh(null),eg(!1)},className:"absolute right-2 top-1/2 -translate-y-1/2 rounded-full p-1 text-blue-100/50 hover:text-white",title:"Clear URL",children:(0,o.jsx)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsxs)("label",{className:"mb-2 block text-sm font-medium text-blue-100/80",children:["Model ",(0,o.jsx)("span",{className:"text-yellow-400",children:"*"})]}),(0,o.jsxs)("select",{value:C,onChange:e=>{let t=e.target.value;R(t),"sora-2"===t&&(U(""),L(""))},className:"w-full rounded-2xl border border-white/15 bg-white/5 px-3 py-2 text-white shadow-lg backdrop-blur-sm focus:border-energy-water focus:outline-none focus:ring-2 focus:ring-energy-water",children:[(0,o.jsx)("option",{value:"sora-2",className:"text-black",children:"Sora Preview"}),(0,o.jsx)("option",{value:"veo-flash",className:"text-black",children:"Veo Flash"}),(0,o.jsxs)("option",{value:"veo-pro",className:"text-black",disabled:(null==eR?void 0:eR.veoProEnabled)===!1,children:["Veo Pro",(null==eR?void 0:eR.veoProEnabled)===!1?" (Upgrade required)":""]})]}),(0,o.jsxs)("p",{className:"mt-1 text-xs text-blue-100/50",children:["sora-2"===C&&"Fast, lightweight video generation for early exploration.","veo-flash"===C&&"Quality upgrade with audio, still fast for drafts and testing.","veo-pro"===C&&((null==eR?void 0:eR.veoProEnabled)===!1?"Veo Pro is available on paid packs. Upgrade to unlock final export quality.":"Preferred when final quality and sound matter.")]}),(null==eR?void 0:eR.veoProEnabled)===!1&&"veo-pro"===C&&(0,o.jsxs)("div",{className:"mt-2 rounded-lg border border-yellow-500/30 bg-yellow-500/10 p-2 text-xs text-yellow-200",children:["Veo Pro is locked on Starter Access. ",(0,o.jsx)(i.default,{href:"/pricing",className:"underline hover:text-yellow-100",children:"Upgrade to unlock"})]})]}),(0,o.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"mb-2 block text-sm font-medium text-blue-100/80",children:"Aspect Ratio"}),(0,o.jsxs)("select",{value:N,onChange:e=>S(e.target.value),className:"w-full rounded-2xl border border-white/15 bg-white/5 px-3 py-2 text-white shadow-lg backdrop-blur-sm focus:border-energy-water focus:outline-none focus:ring-2 focus:ring-energy-water",children:[(0,o.jsx)("option",{value:"9:16",className:"text-black",children:"9:16 (Portrait)"}),(0,o.jsx)("option",{value:"16:9",className:"text-black",children:"16:9 (Landscape)"})]})]}),"sora-2"===C&&(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"mb-2 block text-sm font-medium text-blue-100/80",children:"Duration (seconds)"}),(0,o.jsxs)("select",{value:P,onChange:e=>_(e.target.value),className:"w-full rounded-2xl border border-white/15 bg-white/5 px-3 py-2 text-white shadow-lg backdrop-blur-sm focus:border-energy-water focus:outline-none focus:ring-2 focus:ring-energy-water",children:[(0,o.jsx)("option",{value:"10",className:"text-black",children:"10 seconds"}),(0,o.jsx)("option",{value:"15",className:"text-black",children:"15 seconds"})]})]})]}),("veo-flash"===C||"veo-pro"===C)&&(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"mb-2 block text-sm font-medium text-blue-100/80",children:"First Frame URL (Optional)"}),(0,o.jsx)("input",{type:"url",value:T,onChange:e=>U(e.target.value),className:"w-full rounded-2xl border border-white/15 bg-white/5 px-3 py-2 text-white placeholder:text-blue-100/50 shadow-lg backdrop-blur-sm focus:border-energy-water focus:outline-none focus:ring-2 focus:ring-energy-water",placeholder:"https://example.com/firstFrame.png"}),(0,o.jsx)("p",{className:"mt-1 text-xs text-blue-100/50",children:"First frame image URL for video generation"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"mb-2 block text-sm font-medium text-blue-100/80",children:"Last Frame URL (Optional)"}),(0,o.jsx)("input",{type:"url",value:E,onChange:e=>L(e.target.value),className:"w-full rounded-2xl border border-white/15 bg-white/5 px-3 py-2 text-white placeholder:text-blue-100/50 shadow-lg backdrop-blur-sm focus:border-energy-water focus:outline-none focus:ring-2 focus:ring-energy-water",placeholder:"https://example.com/lastFrame.png"}),(0,o.jsx)("p",{className:"mt-1 text-xs text-blue-100/50",children:"Last frame image URL (requires first frame URL)"})]})]}),(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("input",{type:"checkbox",id:"useWebhook",checked:I,onChange:e=>V(e.target.checked),className:"h-4 w-4 rounded border-white/20 bg-white/10 text-energy-water focus:ring-energy-water"}),(0,o.jsx)("label",{htmlFor:"useWebhook",className:"ml-2 text-sm text-blue-100/80",children:"Use Webhook callback (Recommended, real-time updates)"})]}),(0,o.jsx)("button",{type:"submit",disabled:!eL,className:"w-full rounded-2xl bg-gradient-to-r from-[#1f75ff] via-[#3f8cff] to-[#6fd6ff] px-4 py-3 text-base font-semibold text-white shadow-[0_25px_55px_-25px_rgba(33,122,255,0.9)] transition-transform hover:brightness-110 focus:outline-none focus:ring-2 focus:ring-offset-0 focus:ring-energy-water disabled:opacity-50 disabled:cursor-not-allowed",children:e?D?"Generating Preview...":"Generate Preview":"Initializing..."}),(0,o.jsx)("p",{className:"mt-2 text-xs text-blue-100/70 text-center",children:e?D?"Submitting request…":eE||"Ready to generate.":"Setting up secure connection… Please wait a moment."})]})]}),m&&m.trim()&&(0,o.jsxs)("div",{className:"mb-8 rounded-2xl border border-white/10 bg-white/5 p-6 shadow-[0_25px_80px_-45px_rgba(0,0,0,0.85)] backdrop-blur-xl",children:[(0,o.jsx)("h2",{className:"text-2xl font-semibold text-white mb-4",children:"About This Video Generation"}),(0,o.jsxs)("div",{className:"space-y-4 text-blue-100/80",children:[(0,o.jsxs)("p",{className:"text-base leading-relaxed",children:["This page is specifically designed to generate a video based on the prompt: ",(0,o.jsx)("strong",{className:"text-white",children:m})]}),(0,o.jsx)("p",{className:"text-sm",children:"Each video generated from this prompt will be unique, created using OpenAI's Sora 2.0 model. The AI interprets your description and creates a high-quality video that matches your vision."}),(0,o.jsxs)("div",{className:"mt-4 p-4 rounded-xl bg-white/5 border border-white/10",children:[(0,o.jsx)("h3",{className:"text-lg font-semibold text-white mb-2",children:"Video Details"}),(0,o.jsxs)("ul",{className:"space-y-2 text-sm",children:[(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{className:"text-white",children:"Prompt:"})," ",m]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{className:"text-white",children:"Model:"})," OpenAI Sora 2.0"]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{className:"text-white",children:"Technology:"})," AI Video Generation"]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{className:"text-white",children:"Platform:"})," Sora2Ai Videos"]})]})]})]})]}),A&&(0,o.jsxs)("div",{className:"mb-8 rounded-2xl border border-white/10 bg-white/5 p-6 shadow-[0_25px_80px_-45px_rgba(0,0,0,0.85)] backdrop-blur-xl",children:[(0,o.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Generation Result"}),(0,o.jsxs)("div",{className:"rounded-lg border border-gray-200 p-4 dark:border-gray-700",children:[(0,o.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,o.jsx)("div",{className:"flex-1",children:(0,o.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:A.prompt||"Video Generation Task"})}),(0,o.jsx)("span",{className:"inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ".concat((e=>{switch(e){case"succeeded":return"text-green-600 bg-green-50";case"failed":return"text-red-600 bg-red-50";case"processing":return"text-blue-600 bg-blue-50";default:return"text-gray-600 bg-gray-50"}})(A.status)),children:(e=>{switch(e){case"succeeded":return"Success";case"failed":return"Failed";case"processing":return"Processing";case"pending":return"Pending";default:return e}})(A.status)})]}),"processing"===A.status&&(0,o.jsxs)("div",{className:"mt-4",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400 mb-2",children:[(0,o.jsx)("span",{children:"Generation Progress"}),(0,o.jsxs)("span",{children:[A.progress||0,"%"]})]}),(0,o.jsx)("div",{className:"h-3 w-full rounded-full bg-gray-200 dark:bg-gray-700",children:(0,o.jsx)("div",{className:"h-3 rounded-full bg-energy-water transition-all duration-300",style:{width:"".concat(A.progress||0,"%")}})}),(0,o.jsx)("p",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:"Generating video, please wait..."})]}),"succeeded"===A.status&&A.video_url&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"mt-4 flex justify-center",children:(0,o.jsx)("video",{src:A.video_url,controls:!0,className:"w-full max-w-full rounded-lg",preload:"metadata",playsInline:!0,crossOrigin:"anonymous",style:{width:"100%",height:"auto",maxWidth:er?"".concat(er,"px"):"100%"},onLoadedMetadata:e=>{var t,r;let o=e.currentTarget,a=window.devicePixelRatio||1,s=o.videoWidth?Math.floor(o.videoWidth/a):null;eo(s);let i=o.videoWidth?o.clientWidth*a/o.videoWidth:null;console.log("[VideoPage] \uD83D\uDCF9 Video loaded:",{src:A.video_url,videoWidth:o.videoWidth,videoHeight:o.videoHeight,duration:o.duration,readyState:o.readyState,networkState:o.networkState,devicePixelRatio:a,maxCssWidthNoUpscale:s,displayedCssPx:{width:o.clientWidth,height:o.clientHeight},upscaling:i,isFromR2:null===(t=A.video_url)||void 0===t?void 0:t.includes("r2.dev"),isFromOriginalApi:!(null===(r=A.video_url)||void 0===r?void 0:r.includes("r2.dev"))})},onError:e=>{let t=e.currentTarget.networkState,r=3===t?"Video URL has expired (GRSAI videos expire after 2 hours). Please try generating the video again.":2===t?"Video is still loading. Please wait...":"Failed to load video. The video URL may have expired or the server is unavailable.";console.error("[VideoPage] ❌ Video load error:",{error:e,src:A.video_url,networkState:t,errorMessage:r}),H(r)},onLoadedData:()=>{H(null)},children:"Your browser does not support video playback"})}),Z?(0,o.jsx)("div",{className:"mt-2 rounded-md bg-yellow-50 p-3 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800",children:(0,o.jsxs)("p",{className:"text-xs font-medium text-yellow-800 dark:text-yellow-200",children:["⚠️ ",Z]})}):(0,o.jsx)("p",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400 text-center",children:"If you encounter any issues, please return to the homepage and provide feedback. We will contact you as soon as possible after receiving your message."}),(0,o.jsxs)("div",{className:"mt-4 flex items-center justify-between",children:[(0,o.jsxs)("div",{className:"flex items-center gap-3",children:[A.remove_watermark&&(0,o.jsx)("span",{className:"text-xs text-green-600 dark:text-green-400",children:"✓ No Watermark"}),A.task_id&&(0,o.jsxs)("a",{href:"/api/video/download/".concat(A.task_id),download:"video-".concat(A.task_id,".mp4"),className:"inline-flex items-center gap-2 rounded-lg bg-energy-water px-4 py-2 text-sm font-medium text-white hover:bg-energy-water/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:Z?"Video URL may have expired. Click to try downloading (will attempt to re-fetch from API).":"Download original quality video directly from API (no compression, no storage)",onClick:async e=>{e.preventDefault(),ew(!0);try{let e=await eD(),t=await fetch("/api/video/download/".concat(A.task_id),{headers:e,credentials:"include"});if(t.ok){let e=await t.blob(),r=window.URL.createObjectURL(e),o=document.createElement("a");o.href=r,o.download="video-".concat(A.task_id,".mp4"),o.style.display="none";try{document.body.appendChild(o)}catch(e){console.warn("Failed to append download link:",e)}try{o.click()}catch(e){console.warn("Failed to trigger download:",e)}try{o.parentNode&&document.body.contains(o)?document.body.removeChild(o):o.parentNode?o.parentNode.removeChild(o):o.remove&&"function"==typeof o.remove&&o.remove()}catch(e){try{o.remove&&"function"==typeof o.remove&&o.remove()}catch(e){console.debug("Element removal failed (safe to ignore):",e)}}try{window.URL.revokeObjectURL(r)}catch(e){console.warn("Failed to revoke object URL:",e)}es.current&&H(null)}else if(401===t.status)H("Unauthorized, please login first");else if(404===t.status){let e=await t.json().catch(()=>({}));H(e.details||e.error||"Video not found (the video URL may have expired). Please try generating the video again.")}else{let e=await t.json().catch(()=>({}));H(e.details||e.error||"Failed to download video (HTTP ".concat(t.status,")."))}}catch(e){console.error("Download error:",e),H("Failed to download video. Please try again or generate a new video.")}},children:[(0,o.jsx)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),Z?"Try Download (Re-fetch)":"Download Original Video"]})]}),(0,o.jsx)("button",{onClick:()=>F(null),className:"text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:"Clear"})]}),"sora-2"===C&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(c,{onRefine:()=>{F(null)},onUpgrade:()=>{R("veo-pro"),F(null)},prompt:A.prompt}),(0,o.jsx)("div",{className:"mt-4",children:(0,o.jsx)(h,{soraRenders7d:eP,remixSamePrompt24h:eI,bonusUsageRatio:0,exportIntent:ev,prompt:A.prompt,aspectRatio:N,onUpgradeToVeoPro:()=>{R("veo-pro")},onDismiss:()=>{}})}),(0,o.jsx)(x,{planId:K?"creator":"starter",soraRendersThisSession:ek,promptText:A.prompt,onUpgrade:()=>{r.push("/pricing")},onDismiss:()=>{}})]})]}),"failed"===A.status&&(0,o.jsxs)("div",{className:"mt-4 rounded-md bg-blue-50 p-4 dark:bg-blue-900/20",children:[(0,o.jsx)("p",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:"Trying a different variation to improve the result…"}),(0,o.jsxs)("div",{className:"mt-2 space-y-2",children:[(0,o.jsx)("p",{className:"text-sm text-red-600 dark:text-red-300",children:A.error||"Unknown error"}),"veo-pro"!==C&&(Q>=1||ee)&&(0,o.jsx)("div",{className:"mt-3",children:(0,o.jsx)(d,{onClose:()=>et(!1)})}),(0,o.jsx)("div",{className:"mt-3 rounded-md bg-green-50 p-3 dark:bg-green-900/20 border border-green-200 dark:border-green-800",children:(0,o.jsxs)("p",{className:"text-xs font-medium text-green-800 dark:text-green-200 flex items-center gap-1",children:[(0,o.jsx)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"veo-pro"===C?"Credits have been automatically refunded (Veo Pro auto-refund on failure). You can try again with a different prompt.":"Credits have been automatically refunded. You can try again with a different prompt."]})}),eF&&(0,o.jsxs)("div",{className:"mt-3 rounded-md bg-yellow-50 p-3 dark:bg-yellow-900/20",children:[(0,o.jsxs)("p",{className:"text-xs font-medium text-yellow-800 dark:text-yellow-200 mb-1",children:["⚠️ ",eF.headline]}),(0,o.jsx)("p",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:eF.description}),(0,o.jsx)("ul",{className:"mt-1 ml-4 list-disc text-xs text-yellow-700 dark:text-yellow-300 space-y-1",children:eF.suggestions.map(e=>(0,o.jsx)("li",{children:e},e))})]})]}),(0,o.jsx)("button",{onClick:()=>F(null),className:"mt-3 text-sm text-red-600 hover:text-red-700 dark:text-red-400",children:"Close"})]})]})]}),!m&&(0,o.jsxs)("div",{className:"mb-8 rounded-2xl border border-white/10 bg-white/5 p-6 shadow-[0_25px_80px_-45px_rgba(0,0,0,0.85)] backdrop-blur-xl",children:[(0,o.jsx)("h2",{className:"text-2xl font-semibold text-white mb-4",children:"How to Create AI Videos with Sora2Ai"}),(0,o.jsxs)("div",{className:"space-y-4 text-blue-100/80",children:[(0,o.jsx)("p",{className:"text-base leading-relaxed",children:"Creating AI-generated videos with Sora2Ai is simple and straightforward. Start by entering a detailed text prompt that describes the video you want to create. Be specific about the scene, style, camera movement, lighting, mood, and any other visual elements you're looking for. The more detailed your description, the better the AI can understand and create your vision."}),(0,o.jsx)("p",{className:"text-base leading-relaxed",children:"Our platform uses OpenAI Sora 2.0, one of the most advanced AI video generation models available. Each video is generated with high quality and attention to detail, ensuring professional results suitable for marketing, social media, education, or creative projects. You can choose between portrait (9:16) or landscape (16:9) aspect ratios, and select video duration of 10 or 15 seconds based on your needs."}),(0,o.jsx)("p",{className:"text-base leading-relaxed",children:"After submitting your prompt, the video generation process typically takes a few minutes. You'll receive real-time updates on the progress through our webhook system, and once complete, you can download and use your video immediately. Each video generation costs 10 credits, and new users receive 30 free credits to get started."}),(0,o.jsx)("h3",{className:"text-lg font-semibold text-white mt-6 mb-3",children:"Best Practices for Writing Video Prompts"}),(0,o.jsxs)("ul",{className:"list-disc list-inside space-y-2 text-sm ml-4",children:[(0,o.jsx)("li",{children:"Be specific about visual elements: colors, lighting, camera angles, and movement"}),(0,o.jsx)("li",{children:"Describe the mood and atmosphere you want to convey"}),(0,o.jsx)("li",{children:"Include details about style: realistic, cinematic, documentary, animated, etc."}),(0,o.jsx)("li",{children:"Mention any specific objects, characters, or scenes you want included"}),(0,o.jsx)("li",{children:"Use descriptive language to help the AI understand your creative vision"})]})]})]})]})]})]})}function k(){let e=(0,s.useRouter)(),[t,r]=(0,a.useState)(null);return((0,a.useEffect)(()=>{let t=(0,f.createClient)();(async()=>{let{data:{session:o}}=await t.auth.getSession();if(!o){r(!1);let t="".concat(window.location.pathname).concat(window.location.search);(0,b.Ko)(t),e.replace("/login?redirect=".concat(encodeURIComponent(t)));return}r(!0)})();let{data:{subscription:o}}=t.auth.onAuthStateChange((t,o)=>{if(o)r(!0);else{r(!1);let t="".concat(window.location.pathname).concat(window.location.search);(0,b.Ko)(t),e.replace("/login?redirect=".concat(encodeURIComponent(t)))}});return()=>{o.unsubscribe()}},[e]),null===t)?(0,o.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:"Loading..."}):t?(0,o.jsx)(y,{}):null}},2655:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var o=r(7437),a=r(970),s=r(2265);function i(){let[e,t]=(0,s.useState)(!1),r=async()=>{try{t(!0);let e=(0,a.createClient)();await e.auth.signOut(),Object.keys(localStorage).forEach(e=>{(e.includes("supabase")||e.includes("sb-"))&&localStorage.removeItem(e)}),await fetch("/api/auth/logout",{method:"POST"}),window.location.href="/"}catch(e){console.error("Logout error:",e),window.location.href="/"}finally{t(!1)}};return(0,o.jsx)("button",{onClick:r,disabled:e,className:"rounded-lg bg-red-600 px-4 py-2 text-sm font-semibold text-white transition-colors hover:bg-red-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-600 disabled:opacity-50 disabled:cursor-not-allowed",children:e?"Signing out...":"Sign Out"})}},1509:function(e,t,r){"use strict";function o(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]}r.d(t,{j:function(){return o}})},3426:function(e,t,r){"use strict";r.d(t,{Ko:function(){return s},TW:function(){return n},r4:function(){return i}});let o="s2ai_post_login_redirect";function a(e){if(!e)return null;let t=String(e).trim();return!t||!t.startsWith("/")||t.startsWith("//")||t.includes("://")||t.startsWith("/auth/callback")||t.startsWith("/login")?null:t}function s(e){let t=a(e);if(t){try{"undefined"!=typeof sessionStorage&&sessionStorage.setItem(o,t)}catch(e){}try{"undefined"!=typeof localStorage&&localStorage.setItem(o,t)}catch(e){}}}function i(){let e=null;try{"undefined"!=typeof sessionStorage&&(e=sessionStorage.getItem(o))}catch(e){}if(!e)try{"undefined"!=typeof localStorage&&(e=localStorage.getItem(o))}catch(e){}return a(e)}function n(){try{"undefined"!=typeof sessionStorage&&sessionStorage.removeItem(o)}catch(e){}try{"undefined"!=typeof localStorage&&localStorage.removeItem(o)}catch(e){}}},970:function(e,t,r){"use strict";let o,a;r.d(t,{createClient:function(){return n}});var s=r(3053);let i=new Map;function n(){let e="https://hgzpzsiafycwlqrkzbis.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhnenB6c2lhZnljd2xxcmt6YmlzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI2MTk4NzIsImV4cCI6MjA3ODE5NTg3Mn0.WdpkrSXVZVZ64bY8NXG6Bpf-w59i305F7agny6wuj_Q";if(!e||!t)throw Error("Missing Supabase environment variables");return a||(a=function(){let e=function(){try{return"localStorage"in window?window.localStorage:null}catch(e){return null}}(),t=function(){try{return"sessionStorage"in window?window.sessionStorage:null}catch(e){return null}}();return{async getItem(r){var o;r.endsWith("-code-verifier")&&console.log("[SupabaseStorage] getItem start",{key:r});let a=null==e?void 0:e.getItem(r);if(null!=a)return i.set(r,a),r.endsWith("-code-verifier")&&console.log("[SupabaseStorage] getItem hit localStorage",{key:r}),a;let s=null==t?void 0:t.getItem(r);if(null!=s)return i.set(r,s),r.endsWith("-code-verifier")&&console.log("[SupabaseStorage] getItem hit sessionStorage",{key:r}),s;let n=function(e){if("undefined"==typeof document)return null;for(let t of document.cookie?document.cookie.split("; "):[]){let[r,...o]=t.split("=");if(r===e)return decodeURIComponent(o.join("="))}return null}(r);return null!==n?(i.set(r,n),r.endsWith("-code-verifier")&&console.log("[SupabaseStorage] getItem hit cookie",{key:r}),n):(r.endsWith("-code-verifier")&&console.log("[SupabaseStorage] getItem miss",{key:r}),null!==(o=i.get(r))&&void 0!==o?o:null)},async setItem(r,o){let a=String(o);try{null==e||e.setItem(r,a),r.endsWith("-code-verifier")&&console.log("[SupabaseStorage] setItem localStorage success",{key:r})}catch(e){r.endsWith("-code-verifier")&&console.warn("[SupabaseStorage] setItem localStorage failed",{key:r,error:e})}try{null==t||t.setItem(r,a),r.endsWith("-code-verifier")&&console.log("[SupabaseStorage] setItem sessionStorage success",{key:r})}catch(e){r.endsWith("-code-verifier")&&console.warn("[SupabaseStorage] setItem sessionStorage failed",{key:r,error:e})}if(r.endsWith("-code-verifier"))try{(function(e,t,r){if("undefined"==typeof document)return;let o="https:"===window.location.protocol,a="".concat(e,"=").concat(encodeURIComponent(t),"; Path=/; SameSite=Lax; Max-Age=").concat(600).concat(o?"; Secure":"");document.cookie=a})(r,a,0),console.log("[SupabaseStorage] setItem cookie success",{key:r})}catch(e){console.warn("[SupabaseStorage] setItem cookie failed",{key:r,error:e})}i.set(r,a),r.endsWith("-code-verifier")&&console.log("[SupabaseStorage] setItem memory store",{key:r})},async removeItem(r){try{null==e||e.removeItem(r),r.endsWith("-code-verifier")&&console.log("[SupabaseStorage] removeItem localStorage",{key:r})}catch(e){r.endsWith("-code-verifier")&&console.warn("[SupabaseStorage] removeItem localStorage failed",{key:r,error:e})}try{null==t||t.removeItem(r),r.endsWith("-code-verifier")&&console.log("[SupabaseStorage] removeItem sessionStorage",{key:r})}catch(e){r.endsWith("-code-verifier")&&console.warn("[SupabaseStorage] removeItem sessionStorage failed",{key:r,error:e})}r.endsWith("-code-verifier")&&("undefined"!=typeof document&&(document.cookie="".concat(r,"=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Lax")),console.log("[SupabaseStorage] removeItem cookie",{key:r})),i.delete(r)}}}()),o||(o=(0,s.eI)(e,t,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,flowType:"pkce",storage:a}})),o}},9376:function(e,t,r){"use strict";var o=r(5475);r.o(o,"useParams")&&r.d(t,{useParams:function(){return o.useParams}}),r.o(o,"usePathname")&&r.d(t,{usePathname:function(){return o.usePathname}}),r.o(o,"useRouter")&&r.d(t,{useRouter:function(){return o.useRouter}}),r.o(o,"useSearchParams")&&r.d(t,{useSearchParams:function(){return o.useSearchParams}})}},function(e){e.O(0,[2972,4609,3053,5726,2971,2117,1744],function(){return e(e.s=1477)}),_N_E=e.O()}]);